% For double-blind review submission, w/o CCS and ACM Reference (max
% submission space)
\documentclass[acmsmall,review,anonymous]{acmart}
\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For double-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review,anonymous]{acmart}\settopmatter{printfolios=true}
%% For single-blind review submission, w/o CCS and ACM Reference (max submission space)
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For single-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true}
%% For final camera-ready submission, w/ required CCS and ACM Reference
%\documentclass[acmsmall]{acmart}\settopmatter{}


%% Journal information
%% Supplied to authors by publisher for camera-ready submission;
%% use defaults for review submission.
\acmJournal{PACMPL}
\acmVolume{1}
\acmNumber{POPL} % CONF = POPL or ICFP or OOPSLA
\acmArticle{1}
\acmYear{2020}
\acmMonth{1}
\acmDOI{} % \acmDOI{10.1145/nnnnnnn.nnnnnnn}
\startPage{1}

%% Copyright information
%% Supplied to authors (based on authors' rights management selection;
%% see authors.acm.org) by publisher for camera-ready submission;
%% use 'none' for review submission.
\setcopyright{none}
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
%\setcopyright{rightsretained}
%\copyrightyear{2018}           %% If different from \acmYear

%% Bibliography style
\bibliographystyle{ACM-Reference-Format}
%% Citation style
%% Note: author/year citations are required for papers published as an
%% issue of PACMPL.
\citestyle{acmauthoryear}   %% For author/year citations
%\citestyle{acmnumeric}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Note: Authors migrating a paper from PACMPL format to traditional
%% SIGPLAN proceedings format must update the '\documentclass' and
%% topmatter commands above; see 'acmart-sigplanproc-template.tex'.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\usepackage[utf8]{inputenc}
\usepackage{ccicons}
\usepackage{verbatim}

\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amscd}
%\usepackage{MnSymbol}
\usepackage{xcolor}

\usepackage{bbold}
\usepackage{url}
\usepackage{upgreek}
%\usepackage{stmaryrd}

\usepackage{lipsum}
\usepackage{tikz-cd}
\usetikzlibrary{cd}
\usetikzlibrary{calc}
\usetikzlibrary{arrows}

\usepackage{bussproofs}
\EnableBpAbbreviations

\input{macros}
\input{mytheorem}

\theoremstyle{definition}
\newtheorem{exmpl}{Example}

\renewcommand{\greyout}[1]{} %{{\color{gray} {#1}}} -- toggle to remove greyed text

\newcommand{\new}[1]{{\color{blue} {#1}}}


\newcommand{\emptyfun}{{[]}}
\newcommand{\cal}{\mathcal}
%\newcommand{\fold}{\mathit{fold}}
\newcommand{\F}{\mathcal{F}}
\renewcommand{\G}{\mathcal{G}}
\newcommand{\N}{\mathcal{N}}
\newcommand{\E}{\mathcal{E}}
\newcommand{\B}{\mathcal{B}}
\renewcommand{\P}{\mathcal{A}}
\newcommand{\pred}{\mathsf{Fam}}
\newcommand{\env}{\mathsf{Env}}
\newcommand{\set}{\mathsf{Set}}
\renewcommand{\S}{\mathcal S}
\renewcommand{\C}{\mathcal{C}}
\newcommand{\D}{\mathcal{D}}
\newcommand{\A}{\mathcal{A}}
\renewcommand{\id}{\mathit{id}}
\newcommand{\map}{\mathsf{map}}
\newcommand{\pid}{\underline{\mathit{id}}}
\newcommand{\pcirc}{\,\underline{\circ}\,}
\newcommand{\pzero}{\underline{0}}
\newcommand{\pone}{\underline{1}}
\newcommand{\psum}{\,\underline{+}\,}
\newcommand{\pinl}{\underline{\mathit{inL}}\,}
\newcommand{\pinr}{\underline{\mathit{inR}}\,}
\newcommand{\ptimes}{\,\underline{\times}\,}
\newcommand{\ppi}{\underline{\pi_1}}
\newcommand{\pppi}{\underline{\pi_2}}
\newcommand{\pmu}{\underline{\mu}}
\newcommand{\semmap}{\mathit{map}}
\newcommand{\subst}{\mathit{subst}}

\newcommand{\tb}[1]{~~ \mbox{#1} ~~}
\newcommand{\listt}[1]{(\mu \phi. \lambda \beta . \onet + \beta \times
  \phi \beta) #1} 
\newcommand{\filtype}{\Nat^\emptyset 
 (\Nat^\emptyset \, \alpha \, \mathit{Bool})\, (\Nat^\emptyset 
  (List \, \alpha) \, (List \, \alpha))} 
\newcommand{\filtypeGRose}{\Nat^\emptyset 
 (\Nat^\emptyset \, \alpha \, \mathit{Bool})\, (\Nat^\emptyset 
  (\mathit{GRose}\,\psi \, \alpha) \, (\mathit{GRose}\,\psi \, (\alpha
  + \onet)))} 
\newcommand{\maplist}{\mathit{map}_{\lambda A. \setsem{\emptyset; \alpha
      \vdash \mathit{List} \, \alpha} \rho[\alpha := A]}} 
\newcommand{\PLeaves}{\mathsf{PLeaves}}
\newcommand{\swap}{\mathsf{swap}}
\newcommand{\reverse}{\mathsf{reverse}}
\newcommand{\Bcons}{\mathit{Bcons}}
\newcommand{\Bnil}{\mathit{Bnil}}

\title[Practical Parametricity for GADTs]{Practical Parametricity for GADTs}
  %Primitive
  %% [Short Title] is optional; when present,
                         %% will be used in header instead of Full
                         %% Title.
%\titlenote{with title note}             %% \titlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'
%\subtitle{Subtitle}                     %% \subtitle is optional
%\subtitlenote{with subtitle note}       %% \subtitlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'


%% Author information
%% Contents and number of authors suppressed with 'anonymous'.
%% Each author should be introduced by \author, followed by
%% \authornote (optional), \orcid (optional), \affiliation, and
%% \email.
%% An author may have multiple affiliations and/or emails; repeat the
%% appropriate command.
%% Many elements are not rendered, but should be provided for metadata
%% extraction tools.

%% Author with single affiliation.
\author{Patricia Johann, Enrico Ghiorzi, and Daniel Jeffries}
%\authornote{with author1 note}          %% \authornote is optional;
%                                        %% can be repeated if necessary
%\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
\affiliation{
%  \position{Position1}
%  \department{Department1}              %% \department is recommended
  \institution{Appalachian State University}            %% \institution is required
%  \streetaddress{Street1 Address1}
%  \city{City1}
%  \state{State1}
%  \postcode{Post-Code1}
%  \country{Country1}                    %% \country is recommended
}
\email{johannp@appstate.edu, ghiorzie@appstate.edu, jeffriesd@appstate.edu}          %% \email is recommended


\begin{document}

\begin{abstract}
Abstract goes here
\end{abstract}

%\begin{CCSXML}
%<ccs2012>
%<concept>
%<concept_id>10011007.10011006.10011008</concept_id>
%<concept_desc>Software and its engineering~General programming languages</concept_desc>
%<concept_significance>500</concept_significance>
%</concept>
%<concept>
%<concept_id>10003456.10003457.10003521.10003525</concept_id>
%<concept_desc>Social and professional topics~History of programming languages</concept_desc>
%<concept_significance>300</concept_significance>
%</concept>
%</ccs2012>
%\end{CCSXML}
%
%\ccsdesc[500]{Software and its engineering~General programming languages}
%\ccsdesc[300]{Social and professional topics~History of programming languages}
%% End of generated code


%% Keywords
%% comma separated list
%\keywords{keyword1, keyword2, keyword3}  %% \keywords is optional


\maketitle

\new{Maybe develop our theory for {\em any} $\lambda \geq \omega_1$,
  and then specialize to $\omega_1$ when discussing GADTs? Can we do
  that? It seems we really use properties of $\oCPO$ to get that
  interpretations of $\Nat$-types are well-defined.}

\new{Locally presentable categories are the closest approximation to
  small complete categories. It's remarkable that local presentability
  is sufficient not just to give semantics to GADTs, but is also all
  that is needed to ensure that the model induced by that semantics is
  actually parametric.}

{\color{red} We should ask what, intuitively, it means to have
  parametricity for a calculus with GADTs. In particular it should
  mean that any polymorphic function that takes a GADT as input should
  operate uniformly over all type instances of the GADT. That means
  that the GADT must itself be ``parametric'', i.e., uniform in its
  type indices. But what does this mean? For ADTs and nested types it
  means that the datatype elements are constructed in exactly the same
  ways at each type instance. For GADTs, it means that as well, but
  here we also have to take into account which instances are actually
  inhabited, since not all type instances of a GADT are inhabited.
  [Of course we did not have to do this for ADTs and nested types
    because {\em all} instances of ADTs and nested types are
    inhabited.] So, intuitively, we consider a GADT to be
  ``parametric'' if 1) the corresponding instances of the GADT are
  inhabited for for every instantiation of its type parameters
  $\ol\alpha$, and 2) the objects for each instantiation of the
  $\alpha$s are constructed in exactly the same way. That is, which
  instances are inhabited, as well as how the data in each of those
  instances are constructed, is type independent. We capture this in
  our calculus by requiring that, for $\Gamma;\Phi \vdash
  (\Lan^{\ol{\alpha^0}}_{\ol K} F)\, \ol A$, we have that
  $\emptyset;\ol\beta \vdash K$, and that $K$ does not involve any
  constants. (The latter ensures that a GADT with a constructor of
  type $\alpha \to Int$ is not parametric, which makes sense since
  there will be more ways to construct Int instances of the GADT than
  ways to construct its other type instances.) Further, to ensure that
  the categorical Lans interpreting $\Lan$-constructs are
  $\omega$-cocontinuous we also require that $K$ is a polynomial
  functor in the $\alpha$s (that necessarily will not involve any
  constant functors). This means that our constructors have types of
  the form $F\ol\beta \to F(K\ol\beta)$ with no constants in $K$, so
  that exactly the corresponding instances of the GADT are inhabited
  for every instantiation of the $\alpha$s, and the objects for each
  instantiation of the $\alpha$s are constructed in exactly the same
  way. That is, the inhabited instances and the construction of the
  data in those instances are type independent.}
  

\section{The Calculus}

\subsection{Types}\label{sec:types}

For each $k \ge 0$, we assume countable sets $\tvars^k$ of \emph{type
  constructor variables of arity $k$} and $\fvars^k$ of
\emph{functorial variables of arity $k$}, all mutually disjoint.
%disjoint for distinct $k$ and disjoint from each other.
The sets of all type constructor variables and functorial variables
are $\tvars = \bigcup_{k \ge 0} \tvars^k$ and $\fvars = \bigcup_{k \ge
  0} \fvars^k$, respectively, and a \emph{type variable} is any
element of $\tvars \cup \fvars$.  We use lower case Greek letters for
type variables, writing $\phi^k$ to indicate that $\phi \in \tvars^k
\cup \fvars^k$, and omitting the arity indicator $k$ when convenient,
unimportant, or clear from context. We reserve letters from the
beginning of the alphabet to denote type variables of arity $0$, i.e.,
elements of $\tvars^0 \cup \fvars^0$. We write $\overline{\zeta}$ for
either a set $\{\zeta_1,...,\zeta_n\}$ of type constructor variables
or a set of functorial variables when the cardinality $n$ of the set
is unimportant or clear from context. If $\Pos\,$ is a set of type
variables we write $\Pos, \overline{\phi}$ for $\Pos\, \cup
\overline{\phi}$ when $\Pos\, \cap \overline{\phi} = \emptyset$.  We
omit the vector notation for a singleton set, thus writing $\phi$,
instead of $\overline{\phi}$, for $\{\phi\}$.
\begin{dfn}
Let $V$ be a finite subset of\, $\tvars$, $\Pos$ be a finite
subset of\, $\fvars$, $\overline{\alpha}$ be a finite subset of\,
$\fvars^0$ disjoint from $\Pos$, and $\phi^k \in \fvars^k
\setminus \Pos$.  The set $\mcF^\Pos(V)$ of {\em functorial
  expressions} over $\Pos$ and $V$ are given by
\begin{align*}
  \mcF^\Pos(V) \; ::= \; 
  & \hspace*{0.15in}
\zerot \mid \onet 
\mid \Nat^\Pos \, \mcF^\Pos (V) \;
\mcF^\Pos (V) 
\mid \Pos\; \ol{\mcF^\Pos(V)}  \,
\mid V\, \ol{\mcF^\Pos(V)}  
\mid \mcF^{\Pos}(V) + \mcF^\Pos(V)\\
&\mid \mcF^{\Pos}(V) \times \mcF^\Pos(V) \mid \left(\mu
\phi^{~k}. \lambda \alpha_1...\alpha_k.  
\mcF^{\Pos,\alpha_1,...,\alpha_k,\phi}(V)\right)
\ol{\mcF^{\Pos}(V)}\\
&\mid (\Lan^{\ol\alpha}_{\ol{\F^{\ol\alpha}}} \F^{\Pos,\ol\alpha})\ol{\F^\Pos}
\end{align*}
\end{dfn}
\noindent
A \emph{type} over $\Pos$ and $V$ is any element of $\F^\Pos(V)$. The
difference with~\cite{jgj20} here lies solely in the incorporation of
functorial expressions constructed from $\Lan$.

The notation for types entails that an application $F F_1...F_k$ is
allowed only when $F$ is a type variable of arity $k$, or $F$ is a
subexpression of the form $\mu \phi^{k}.\lambda
\alpha_1...\alpha_k.F'$ or $\Lan^{\ol\alpha}_{\ol K}\, F'$. Moreover,
if $F$ has arity $k$ then $F$ must be applied to exactly $k$
arguments.  Accordingly, an overbar indicates a sequence of
subexpressions whose length matches the arity of the type applied to
it.  The fact that types are always in \emph{$\eta$-long normal form}
avoids having to consider $\beta$-conversion at the level of types. In
a subexpression $\Nat^\Phi F\,G$, the $\Nat$ operator binds all
occurrences of the variables in $\Phi$ in $F$ and $G$. Note that, by
contrast with~\cite{jgj20}, variables of arity greater than $0$ are
allowed in $\Phi$; this is necessary to construct well-typed terms of
$\Lan$ types. In a subexpression $\mu \phi^k.\lambda \ol{\alpha}.F$,
the $\mu$ operator binds all occurrences of the variable $\phi$, and
the $\lambda$ operator binds all occurrences of the variables in
$\ol{\alpha}$, in the body $F$. And in a subexpression
$(\Lan^{\ol\alpha}_{\ol K}\, F)\ol A$, the $\Lan$ operator binds all
occurrences of the variables in $\ol\alpha$ in every element of $\ol
K$, as well as in $F$.

A {\em type constructor context} is a finite set $\Gamma$ of type
constructor variables, and a {\em functorial context} is a finite set
$\Phi$ of functorial variables. In Definition~\ref{def:wftypes}, a
judgment of the form $\Gamma;\Phi \vdash F$ indicates that the
type $F$ is intended to be functorial in the variables in $\Phi$
but not necessarily in those in $\Gamma$.

\begin{dfn}\label{def:wftypes}
The formation rules for the set $\F \subseteq \bigcup_{V \subseteq
  \tvars, \Pos\, \subseteq \fvars}\F^\Pos(V)$ of\, {\em well-formed
  types} are

\[\begin{array}{cc}
\AXC{\phantom{$\Gamma,\Phi$}}
\UIC{$\Gamma;\Phi \vdash \zerot$}
\DisplayProof
&
\AXC{\phantom{$\Gamma,\Phi$}}
\UIC{$\Gamma;\Phi \vdash \onet$}
\DisplayProof
\end{array}\]

\vspace*{0.1in}

\[\begin{array}{cc}
\AXC{$\Gamma;\Phi \vdash F$}
\AXC{$\Gamma;\Phi \vdash G$}
\BIC{$\Gamma; \Phi \vdash F + G$}
\DisplayProof
&
\AXC{$\Gamma;\Phi \vdash F$}
\AXC{$\Gamma;\Phi \vdash G$}
\BIC{$\Gamma; \Phi \vdash F \times G$}
\DisplayProof
\end{array}\]

\vspace*{0.05in}

\[\begin{array}{c}
\AXC{$\Gamma;\Phi \vdash F$}
\AXC{$\Gamma;\Phi  \vdash G$}
\BIC{$\Gamma;\emptyset \vdash \Nat^\Phi F \,G$}
\DisplayProof
\\[4ex]
\AXC{$\phi^k \in \Gamma \cup \Phi$}
\AXC{$\quad\quad\ol{\Gamma;\Phi \vdash F}$}
\BIC{$\Gamma;\Phi \vdash \phi^k \ol{F}$}
\DisplayProof
\\[3ex]
\AXC{$\Gamma;\ol{\gamma^0},\ol{\alpha^0},\phi^k \vdash F$}
\AXC{$\quad\quad\ol{\Gamma;\Phi,\ol{\gamma^0} \vdash G}$}
\BIC{$\Gamma;\Phi,\ol{\gamma^0} \vdash (\mu \phi^k.\lambda
  \ol{\alpha^0}. \,F)\,\ol{G}$} 
\DisplayProof
\\[5ex]
\AXC{$\Gamma; \Phi,\ol\alpha^0 \vdash F$}
\AXC{$\ol{\Gamma;\ol\alpha^0 \vdash K}$}
\AXC{$\ol{\Gamma;\Phi \vdash A}$}
\TIC{$\Gamma;\Phi \vdash (\Lan^{\ol{\alpha^0}}_{\ol K} F)\, \ol A$}
\DisplayProof
\end{array}\]
\end{dfn}

In addition to textual replacement, we also have a proper substitution
operation on types. If $F$ is a type over $P$ and $V$, if $\Pos$
and $V$ contain only type variables of arity $0$, and if $k=0$ for
every occurrence of $\phi^k$ bound by $\mu$ in $F$, then we say
that $F$ is {\em first-order}; otherwise we say that $F$ is {\em
  second-order}.  Substitution for first-order types is the usual
capture-avoiding textual substitution. We write $F[\alpha :=
  \sigma]$ for the result of substituting $\sigma$ for $\alpha$ in
$F$, and $F[\alpha_1 := F_1,...,\alpha_k := F_k]$, or
$F[\ol{\alpha := F}]$ when convenient, for $F[\alpha_1 :=
  F_1][\alpha_2 := F_2,...,\alpha_k := F_k]$. Substitution
for second-order types is defined below, where we adopt a similar
notational convention for vectors of types. Note that it is not
correct to substitute along non-functorial variables.

\begin{dfn}\label{def:second-order-subst}
If \,$\Gamma; \Phi,\phi^k \vdash H$
%with $k \geq 1$,
and if\, $\Gamma;\Phi, \ol{\alpha} \vdash F$ with
$|\ol\alpha| = k$, then $\Gamma;\Phi \vdash H[\phi :=_{\ol{\alpha}}
  F]$.  Similarly, if \,$\Gamma, \phi^k; \Phi \vdash H$,
%with $k \geq 1$,
and if\, $\Gamma; \ol\psi,\ol{\alpha} \vdash F$ with $|\ol\alpha| = k$
and $\Phi \cap \ol\psi = \emptyset$, then $\Gamma,\ol\psi';\Phi \vdash
H[\phi :=_{\ol{\alpha}} F[\ol{\psi :== \psi'}]]$. Here, the operation
  $(\cdot)[\phi :=_{\ol \alpha} F]$ of {\em second-order type
    substitution along $\ol\alpha$} is defined by:
\[\begin{array}{lll}
\zerot[\phi :=_{\ol{\alpha}} F] & = & \zerot\\[0.5ex]
\onet[\phi :=_{\ol{\alpha}} F] & = & \onet\\[0.25ex]
(\Nat^{\ol\beta} G \,K)[\phi :=_{\ol{\alpha}} F]
& = & \Nat^{\ol\beta}\, (G[\phi :=_{\ol{\alpha}} F]) \,(K[\phi
  :=_{\ol{\alpha}} F])\\
(\psi\ol{G})[\phi :=_{\ol{\alpha}} F] & = &
\left\{\begin{array}{ll}
\psi \,\ol{G[\phi :=_{\ol{\alpha}} F]} & \mbox{if } \psi \not = \phi\\
  F[\ol{\alpha  := G[\phi :=_{\ol{\alpha}} F]}] 
  & \mbox{if } \psi = \phi
\end{array}\right.\\[2.8ex]
(G + K)[\phi :=_{\ol{\alpha}} F] & = & G[\phi
  :=_{\ol{\alpha}} F] + K[\phi :=_{\ol{\alpha}} F]\\[0.5ex] 
(G \times K)[\phi :=_{\ol{\alpha}} F] & = &
G[\phi :=_{\ol{\alpha}} F] \times K[\phi
  :=_{\ol{\alpha}} F]\\[0.5ex]   
((\mu \psi. \lambda \ol{\beta}.\, G)\ol{K})[\phi :=_{\ol{\alpha}}
  F] & = & (\mu \psi. \lambda \ol{\beta}. \,G[\phi :=_{\ol{\alpha}}
  F])\, \ol{K[\phi :=_{\ol{\alpha}} F]}\\[0.5ex]
((\Lan^{\ol{\beta}}_{\ol H}\, G)\ol{K})[\phi :=_{\ol{\alpha}}
  F] & = & (\Lan^{\ol\beta}_{\ol H} \,G[\phi :=_{\ol{\alpha}}
  F])\, \ol{K[\phi :=_{\ol{\alpha}} F]}
\end{array}\]
\end{dfn}
\noindent
We note that $(\cdot)[\phi^0 :=_\emptyset F]$ coincides with
first-order substitution. We also omit $\ol\alpha$ when convenient.

\subsection{Terms}\label{sec:terms}

We now define our term calculus. To do so we assume an infinite set
$\cal V$ of term variables disjoint from $\tvars$ and $\fvars$. If
$\Gamma$ is a type constructor context and $\Phi$ is a functorial
context, then a {\em term context for $\Gamma$ and $\Phi$} is a finite
set of bindings of the form $x : F$, where $x \in {\cal V}$ and
$\Gamma; \Phi \vdash F$. We adopt the same conventions for denoting
disjoint unions and for vectors in term contexts as for type
constructor contexts and functorial contexts.

\begin{dfn}\label{def:well-formed-terms}
Let $\Delta$ be a term context for $\Gamma$ and $\Phi$.  The formation
rules for the set of\, {\em well-formed terms over $\Delta$} are
\[\begin{array}{ccc}
\AXC{$\Gamma;\Phi \vdash F$}
\UIC{$\Gamma;\Phi \,|\, \Delta,x :F \vdash x : F$}
\DisplayProof
&
\AXC{$\Gamma;\Phi \,|\, \Delta \vdash t : \zerot$}
\AXC{$\Gamma;\Phi \vdash F$}
\BIC{$\Gamma;\Phi \,|\, \Delta \vdash \bot_F t  : F$}
\DisplayProof
&
\AXC{$\phantom{\Gamma;\Phi}$}
\UIC{$\Gamma;\Phi \,|\, \Delta \vdash \top : \onet$}
\DisplayProof\\\\
\end{array}\]
\[\begin{array}{cc}
\AXC{$\Gamma;\Phi \,|\, \Delta \vdash s: F$}
\UIC{$\Gamma;\Phi \,|\, \Delta \vdash \inl \,s: F + G$}
\DisplayProof
&
\AXC{$\Gamma;\Phi \,|\, \Delta \vdash t : G$}
\UIC{$\Gamma;\Phi \,|\, \Delta \vdash \inr \,t: F + G$}
\DisplayProof\\\\
\end{array}\]
\[\begin{array}{c}
\AXC{$\Gamma; \Phi \vdash F,G$}
\AXC{$\Gamma;\Phi \,|\, \Delta \vdash t : F+G$}
\AXC{$\Gamma;\Phi \,|\, \Delta, x : F \vdash l : K \hspace{0.3in} \Gamma;\Phi \,|\, \Delta, y : G \vdash r : K$}
\TIC{$\Gamma;\Phi~|~\Delta \vdash \case{t}{x \mapsto l}{y \mapsto r} : K$}
\DisplayProof
\end{array}\]

\vspace*{0.05in}

\[\begin{array}{lll}
\AXC{$\Gamma;\Phi \,|\, \Delta \vdash s: F$}
\AXC{$\Gamma;\Phi \,|\, \Delta \vdash t : G$}
\BIC{$\Gamma;\Phi \,|\, \Delta \vdash (s,t) : F \times G$}
\DisplayProof
&
\AXC{$\Gamma;\Phi \,|\, \Delta \vdash t : F \times G$}
\UIC{$\Gamma;\Phi \,|\, \Delta \vdash \pi_1 t : F$}
\DisplayProof
&
\AXC{$\Gamma;\Phi \,|\, \Delta \vdash t : F \times G$}
\UIC{$\Gamma;\Phi \,|\, \Delta \vdash \pi_2 t : G$}
\DisplayProof
\end{array}\]

\vspace*{0.05in}

\[\begin{array}{c}
\AXC{$\Gamma; \Phi \vdash F$}
\AXC{$\Gamma; \Phi \vdash G$}
\AXC{$\Gamma; \Phi \,|\, \Delta, x : F \vdash t: G$} 
\TIC{$\Gamma; \emptyset
  \,|\, \Delta \vdash L_\Phi x.t : \Nat^\Phi \,F \,G$}
\DisplayProof
\\\\
\AXC{$\ol{\Gamma;\Phi,\ol\beta \vdash K}$}
\AXC{$\Gamma; \emptyset
  \,|\, \Delta \vdash t : \Nat^{\ol\psi} \,F \,G$}
\AXC{$\Gamma;\Phi \,|\, \Delta \vdash s: F[\overline{\psi :=_{\ol\beta} K}]$}
\TIC{$\Gamma;\Phi\,|\, \Delta \vdash t_{\ol K} s:
  G[\overline{\psi :=_{\ol\beta} K}]$}
\DisplayProof
\\\\
\AXC{$\Gamma; \Phi, \ol{\phi} \vdash H$}
\AXC{$\ol{\Gamma; \Phi,\ol{\beta} \vdash F}$}
\AXC{$\ol{\Gamma; \Phi,\ol{\beta} \vdash
    G}$}
\TIC{$\Gamma; \emptyset
  ~|~\emptyset
  \vdash \map^{\ol{F},\ol{G}}_H :
  \Nat^\emptyset\;(\ol{\Nat^{\Phi,\ol{\beta}}\,F\,G})\;
  (\Nat^\Phi\,H[\ol{\phi :=_{\ol{\beta}} F}]\;H[\ol{\phi
      :=_{\ol{\beta}} G}])$} 
\DisplayProof
\\\\
\AXC{$\Gamma; \Phi, \phi, \ol{\alpha} \vdash H$}
\UIC{$\Gamma; \emptyset  \,|\, \emptyset \vdash \tin_H :
  \Nat^{\Phi,\ol{\beta}} H[\phi :=_{\ol{\beta}} (\mu
    \phi.\lambda \ol{\alpha}.H)\ol{\beta}][\ol{\alpha := \beta}]\,(\mu
  \phi.\lambda \ol{\alpha}.H)\ol{\beta}$}
\DisplayProof
\\\\
\AXC{$\Gamma; \phi,\Phi,\ol{\alpha} \vdash H$}
\AXC{$\Gamma; \Phi, \ol{\beta} \vdash F$}
\BIC{$\Gamma; \emptyset  \,|\, \emptyset \vdash \fold^F_H :
  \Nat^\emptyset\; (\Nat^{\Phi,\ol{\beta}}\,H[\phi
    :=_{\ol{\beta}} F][\ol{\alpha := \beta}]\,F)\; (\Nat^{\Phi,\ol{\beta}}
    \,(\mu \phi.\lambda \ol{\alpha}.H)\ol{\beta}\,F)$}
\DisplayProof
\\\\
\AXC{$\Gamma; \Phi,\ol{\alpha}\vdash F$}
\AXC{$\ol{\Gamma; \ol{\alpha} \vdash K}$}
%\AXC{$\ol{\Gamma;\Phi \vdash A} \hspace*{0.3in} \Gamma;\Phi~|~\Delta \vdash t : F[\ol{\alpha :=A}]$}
\BIC{$\Gamma;\emptyset~|~\Delta \vdash \int_{\ol K,F} :
\Nat^{\Phi,\ol\alpha}\,F\, (\Lan^{\ol\alpha}_{\ol K}\,  F)\ol{K}$}  
\DisplayProof
\\\\
\AXC{$\Gamma;\emptyset~|~\Delta \vdash \eta : \Nat^{\Phi,\ol\alpha}\,
  F\;G[\ol{\beta := K}]$}
%\AXC{$\ol{\Gamma;\Phi \vdash B}$}
%\AXC{$\Gamma;\Phi~|~\Delta \vdash t : (\Lan^{\ol\alpha}_{\ol K} F)\,\ol B $}
\UIC{$\Gamma;\emptyset~|~\Delta \vdash \partial^{G, \ol K}_F \eta :
\Nat^{\Phi, \ol\beta}\, (\Lan^{\ol\alpha}_{\ol K} F)\ol \beta\; G$}
\DisplayProof
\end{array}\]
\end{dfn}

\vspace*{0.2in}

In the rule for $L_{\ol{\alpha}}x.t$, the $L$ operator binds all
occurrences of the type variables in $\ol{\alpha}$ in the type of the
term variable $x$ and in the body $t$, as well as all occurrences of
$x$ in $t$. In the rule for $t_{\ol K} s$ there is one functorial
expression in $\ol K$ for every functorial variable in $\ol
\alpha$. In the rule for $\map^{\ol{F},\ol{G}}_H$ there is one
functorial expression $F$ and one functorial expression $G$ for each
functorial variable in $\ol\phi$. Moreover, for each $\phi^k$ in
$\ol\phi$ the number of functorial variables in $\ol\beta$ in the
judgments for its corresponding functorial expresssions $F$ and $G$ is
$k$. In the rules for $\tin_H$ and $\fold^F_H$, the functorial
variables in $\ol{\beta}$ are fresh with respect to $H$, and there is
one $\beta$ for every $\alpha$. (Recall from above that, in order for
the types of $\tin_H$ and $\fold^F_H$ to be well-formed, the length of
$\alpha$ must equal the arity of $\phi$.) In the rule for $\int_{\ol
  K,H}\,t$, there is one functorial expression $A$ for every
functorial variable in $\ol \alpha$, and in the rule for
$\partial^{G,\ol K}_F\,\eta\,t$, there is one functorial expression
$A$ for every functorial expression in $\ol K$ (and hence for every
functorial variable in $\ol \beta$).
    

Substitution for terms is the obvious extension
of the usual capture-avoiding textual substitution, and
Definition~\ref{def:well-formed-terms} ensures that the expected
weakening rules for well-formed terms hold.

\vspace*{0.2in}

\new{Sum and product intro and elim rules should be annotated with
  constituent types for consistency?

\vspace*{0.2in}

We should have a computation rule along the lines of: If $\eta :
\Nat^{\ol\alpha} F \,G[\ol{\beta := K}]$ then
\[\begin{array}{ll}
& (\partial_F^{G,\ol K} \eta)_{\ol{K[\ol{\alpha := A}]}} \circ (\int_{K,F})_{\ol
  A}\; \rightarrow \; \eta_{\ol A}\\
: & F[\ol{\alpha := A}] \to G[\ol{\beta := K[\ol{\alpha :=A}]}]\\
= & F[\ol{\alpha := A}] \to G[\ol{\beta := K}][\ol{\alpha := A}]
\end{array}\]
This will appear as a computational property of the term
interpretations.}

\section{Interpreting Types}\label{sec:type-interp}

The fundamental idea underlying Reynolds' parametricity is to give
each type $F(\alpha)$ with one free variable $\alpha$ both an {\em
  object interpretation} $F_0$ taking sets to sets and a
\emph{relational interpretation} $F_1$ taking relations $R :
\rel(A,B)$ to relations $F_1 (R) : \rel(F_0 (A), F_0 (B))$, and to
interpret each term $t(\alpha,x) : F(\alpha)$ with one free term
variable $x : G(\alpha)$ as a map $t_0$ associating to each set $A$ a
function $t_0(A) : G_0(A) \to F_0(A)$, and to each relation $R$ a
morphism $t_1(R) : G_1(R) \to F_1(R)$.  These interpretations are to
be given inductively on the structures of $F$ and $t$ in such a way
that they imply two fundamental theorems. The first is an
\emph{Identity Extension Lemma}, which states that $F_1(\Eq_A) =
\Eq_{F_0(A)}$, and is the essential property that makes a model
relationally parametric rather than just induced by a logical
relation. The second is an \emph{Abstraction Theorem}, which states
that, for any $R :\rel(A, B)$, $(t_0(A),t_0(B))$ is a morphism in
$\rel$ from $(G_0(A),G_0(B),G_1(R))$ to $(F_0(A),F_0(B),F_1(R))$. The
Identity Extension Lemma is similar to the Abstraction Theorem except
that it holds for {\em all} elements of a type's interpretation, not
just those that are interpretations of terms.  Similar theorems are
expected to hold for types and terms with any number of free
variables.

{\color{red} NOT NEEDED ANYMORE??
To accommodate GADTs, we will need to transition Reynolds' approach
from a $\set$-based semantics to a semantics based on
$\omega$-complete partial orders. We denote the category of
$\omega$-complete partial orders ($\oCPO$s) and their {\color{blue}
  monotone?} sup-preserving morphisms by $\omega$CPO. The underlying
set of an $\oCPO$ $A$ is denoted $|A|$. The category $\oCPOR$ of
$\oCPO$ relations has as its objects triples $(A,B,R)$, where $A, B:
\oCPO$; $R: \rel(|A|, |B|)$; {\color{blue} $(a,b) \in R$, $a \leq a'$,
  and $b \leq b'$ imply $(a',b') \in R$; so next part is redundant?}
and $(\bigvee_{i < \omega} a_i, \bigvee_{i < \omega} b_i) \in R$
whenever $(a_i)_{i < \omega}$ and $(b_i)_{i < \omega}$ are chains in
$A$ and $B$, respectively, such that $(a_i,b_i) \in R$ for all
$i$. The category $\oCPOR$ has as its morphisms from $(A,B,R)$ to
$(A',B',R')$ pairs $(f : A \to A',g : B \to B')$ of morphisms in
$\oCPO$ such that $(f\,a, g\,b) \in R'$ whenever $(a,b) \in R$. We
note that if $(f,g) : (A,B,R) \to (A',B',R')$ and $(a_i)_{i < \omega}$
and $(b_i)_{i < \omega}$ are chains in $A$ and $B$, respectively, then
$ (f \, (\bigvee_{i < \omega} a_i), g \, (\bigvee_{i < \omega} b_i)) =
(\bigvee_{i < \omega} (f a_i), \bigvee_{i < \omega} (g b_i)) \in R'$
necessarily holds.}  We write $R : \oCPOR(A,B)$ in place of $(A,B,R):
\oCPOR$ when convenient. If $R : \oCPOR(A,B)$ then we write $\pi_1 R$
and $\pi_2 R$ for the {\em domain} $A$ of $R$ and the {\em codomain}
$B$ of $R$, respectively. If $A : \oCPO$, then we write $\Eq_A =
(A,A,\Eq_{|A|})$ for the {\em equality relation} on $A$.

To adapt Reynolds' approach, we first inductively define, for each
type, an object interpretation in $\oCPO$ and a relational
interpretation in $\oCPOR$.  Next, we show that these interpretations
satisfy both an Identity Extension Lemma (Theorem~\ref{thm:iel}) and
an Abstraction Theorem (Theorem~\ref{thm:gen-at}) appropriate to the
$\oCPO$ setting. The key to proving our Identity Extension Lemma is a
familiar ``cutting down'' of the interpretations of universally
quantified types to include only the ``parametric'' elements; as
in~\cite{jgj20}, the relevant types of the calculus defined above are
the (now richer) $\Nat$-types.  The requisite cutting down requires
that the object interpretations of our types in $\omega$CPO are
defined simultaneously with their relational interpretations in
$\oCPOR$.  We give the object interpretations for our types in
Section~\ref{sec:obj-interp} and give their relational interpretations
in Section~\ref{sec:rel-interp}.  While the former are relatively
straightforward, the latter are less so, mainly because of the
cocontinuity conditions, adapted from the $\set$-based setting
of~\cite{jgj20}, that must hold if they are to be well-defined. We
develop these conditions in Section~\ref{sec:rel-interp}, which
separates Definitions~\ref{def:set-sem} and~\ref{def:rel-sem} in
space, but otherwise has no impact on the fact that they are given by
mutual induction.

\subsection{Object Interpretations of Types}\label{sec:obj-interp}

The object interpretations of the types in our calculus will be
$\omega$-cocontinuous functors between categories of
$\omega$-cocontinuous functors on categories constructed from the
locally $\omega$-presentable category $\oCPO$.  We therefore begin
by recording some important facts about locally $\omega$-presentable
categories and functors on them, and verifying verify the properties
needed to interpret our syntax.

\subsubsection{Preliminaries}

\new{Perhaps have as preliminaries to entire paper.}

A category is \emph{small} if its collection of morphisms is a set.
It is \emph{locally small} if, for any two objects $A$ and $B$, the
collection of morphisms from $A$ to $B$ is a set. A {\em small
  (co)limit} in a category $\mcC$ is a (co)limit of a diagram $F :
\mcA \to \mcC$, where $\mcA$ is a small category. A category $\mcC$
is {\em (co)complete} if it has all small (co)limits.

A poset $\mcD = (D,\leq)$ is \emph{$\omega$-directed} if every
countable subset of $D$ has a supremum. When $\mcD$ is considered
as a category, we write $d \in \mcD$ to indicate that $d$ is an object
of $\mcD$ (i.e., $d \in D$). An {\em $\omega$-directed colimit} in a
category $\mcC$ is a colimit of a diagram $F : {\mathcal D} \to \mcC$,
where $\mathcal D$ is an $\omega$-directed poset. A category $\mcC$
is {\em $\omega$-cocomplete} if it has all $\omega$-directed
colimits; a {\em cocomplete} category is one that has all colimits.

If $\mcA$ and $\mcC$ are $\omega$-cocomplete, then a functor $F :
\mcA \to \mcC$ is {\em $\omega$-cocontinuous} if it preserves
$\omega$-directed colimits. We write $[\A,\C]_{\omega}$ for the
category of $\omega$-cocontinuous functors from $\A$ to $\C$, and
$\C^\A$ for the category of {\em all} functors from $\A$ to $\C$.
Since (co)limits of functors are computed pointwise, $C^\A$ has all
(co)limits that $\C$ has, and (co)limits of (co)continuous functors
are again (co)continuous. It follows that $[\A,\C]_{(\omega)}$ is
($\omega$-)(co)complete whenever $\C$ is. In particular, if $F :
[\C, \C]_{(\omega)}$ for a(n) ($\omega$-)cocomplete category $\C$,
then we can define $F^0 = \Id$, $F^{\alpha + 1} = F \circ F^\alpha$ at
successor ordinals, and $F^{\bigcup_{\beta < \alpha} \beta} =
\colim{\beta < \alpha} F^\beta$ at limit ordinals.

If $\mcA$ is locally small, then an object $A$ of $\mcA$ is {\em
  $\omega$-presentable} if the functor $\mathsf{Hom}_\mcA(A, -) :
\mcA \to \Set$ preserves $\omega$-directed colimits, i.e., if for
every $\omega$-directed poset $\mathcal D$ and every functor $F :
{\mathcal D} \to \A$, there is a canonical isomorphism $\colim{d \in
  \mcD}{\mathsf{Hom}_\mcA(A,Fd)} \simeq \mathsf{Hom}_{\mcA}(A,
\colim{d \in \mcD}{Fd})$. A locally small category $\mcA$ is {\em
  $\omega$-accessible} if it is $\omega$-cocomplete and has a set
$\mcA_0$ of $\omega$-presentable objects such that every object is
an $\omega$-directed colimit of objects in $\mcA_0$; a locally small
category is {\em locally $\omega$-presentable} if it is
$\omega$-accessible and cocomplete.

The category $\oCPO$ is locally presentable; its presentable objects
are precisely the finite sets.
%The category $\oCPO$ is locally $\omega$-presentable (but not
%locally finitely presentable); see Examples~1.18(2)
%of~\cite{ar94}). Its $\omega$-presentable objects are precisely the
%$\omega$CPOs cardinality less than $\omega$, i.e., the countable
%$\omega$CPOs.
In the next subsection we will interpret type variables in $\tvars^k
\cup \fvars^k$ as elements of $[\oCPO^k,\oCPO]_{\omega}$; the
following special cases of standard results (see, e.g.,~\cite{ar94})
will therefore be critical to deducing important properties of our
object interpretations of types:
\begin{prop}\label{prop:prelims}
\begin{enumerate}
\item If $\C_1,...,\C_n$ are locally $\omega$-presentable categories
  then so is $\C_1 \times ... \times \C_n$. Moreover, the presentable
  objects of $\C_1 \times ... \times \C_n$ are exactly the tuples of
  the form $(P_1,...,P_n)$, where, for each $i = 1,...,n$, the object
  $P_i$ is presentable in $\C_i$.
\item If $\mathcal{A}$ is $\omega$-accessible and $\mathcal{C}$ is
  $\lambda$-cocomplete, then the category $[\mathcal{A},
  \mathcal{C}]_{\omega}$ is naturally equivalent to the category
  $\mathcal{C}^{\mathcal{A}_0}$.
\item If $\mathcal{C}$ is locally $\omega$-presentable and
  $\mathcal{A}_0$ is essentially small, then
  $\mathcal{C}^{\mathcal{A}_0}$ is locally $\omega$-presentable.
\end{enumerate}
\end{prop}
\noindent
Together, the statements in Proposition~\ref{prop:prelims} give that
if $\mathcal{A}$ and $\mathcal{C}$ are locally $\omega$-presentable,
then $[\mathcal{A}, \mathcal{C}]_{\omega}$ is naturally equivalent
to $\mathcal{C}^{\mathcal{A}_0}$, and thus is
$\omega$-presentable. Thus, for all $k_1,...,k_n \in \nat^n$,
$[\mathcal{A}^{k_1}, \mathcal{C}]_{\omega} \times ... \times
[\mathcal{A}^{k_n}, \mathcal{C}]_{\omega}$ is locally
$\omega$-presentable, and therefore $[[\mathcal{A}^{k_1},
    \mathcal{C}]_{\omega} \times ... \times [\mathcal{A}^{k_n},
    \mathcal{C}]_{\omega}, \mathcal{C}]_{\omega}$ is as
well. Taking both $\A$ and $C$ to be $\oCPO$ --- as we will to ensure
that the fixpoints interpreting $\mu$-types in $\oCPO$ exist --- we
have
\begin{prop}\label{prop:nat-interps-sets}
  For all $k_1,...,k_n \in \nat^n$,
  \[[[\oCPO^{k_1}, \oCPO]_{\omega}
  \times ... \times [\oCPO^{k_n}, \oCPO]_{\omega},
  \oCPO]_{\omega}\] is locally $\omega$-presentable.
\end{prop}

\subsubsection{Object Interpretations}

To define the object interpretations of the types in
Definition~\ref{def:wftypes} we must first interpret their
variables. We have:

\begin{dfn}\label{def:set-env}
A {\em $\oCPO$ environment} maps each type variable in $\tvars^k \cup
\fvars^k$ to an element of $[\oCPO^k,\oCPO]_{\omega}$.  A morphism
$f : \rho \to \rho'$ for set environments $\rho$ and $\rho'$ with
$\rho|_\tvars = \rho'|_\tvars$ maps each type constructor variable
$\psi^k \in \tvars$ to the identity natural transformation on $\rho
\psi^k = \rho'\psi^k$ and each functorial variable $\phi^k \in \fvars$
to a natural transformation from the $k$-ary functor $\rho \phi^k$ on
$\oCPO$ to the $k$-ary functor $\rho' \phi^k$ on $\oCPO$.  Composition
of morphisms on set environments is given componentwise, with the
identity morphism mapping each set environment to itself. This gives a
category of set environments and morphisms between them, which we
denote $\oCPOenv$.
\end{dfn}

When convenient we identify a functor in $[\oCPO^0, \oCPO]_{\omega}$
with its value on $\ast$ and consider a $\oCPO$ environment to map a
type variable of arity $0$ to an $\omega$-cocontinuous functor from
$\oCPO^0$ to $\oCPO$, i.e., to an $\oCPO$. If $\Phi =
\{\phi_1^{k_1},...,\phi_n^{k_n}\}$ and $\ol K = \{K_1,...,K_n\}$ where
$K_i : [\oCPO^{k_i},\oCPO]_{\omega}$ for $i = 1,...,n$, then we
write either $\rho[\ol{\Phi := K}]$ or $\rho[\ol{\phi := K}]$ for the
$\oCPO$ environment $\rho'$ such that $\rho' \phi_i = K_i$ for $i =
1,...,n$ and $\rho' \phi = \rho \phi$ if $\phi \not \in \Phi$.  If
$\rho$ is an $\oCPO$ environment, we write $\Eq_\rho$ for the $\oCPOR$
environment (see Definition~\ref{def:reln-env}) such that $\Eq_\rho v
= \Eq_{\rho v}$ for every type variable $v$. The categories
$\oCPORT_k$ and relational interpretations appearing in the third
clause of Definition~\ref{def:set-sem} are given in full in
Section~\ref{sec:rel-interp}. We note that $\omega$-directed
colimits in $\oCPOenv$ are taken pointwise.

\begin{dfn}\label{def:set-sem}
The {\em object interpretation} $\oCPOsem{\cdot} : \F \to [\oCPOenv,
  \oCPO]_{\omega}$ is defined by
\begin{align*}
  \oCPOsem{\Gamma;\Phi \vdash \zerot}\rho &= 0\\
  \oCPOsem{\Gamma;\Phi \vdash \onet}\rho &= 1\\
  \oCPOsem{\Gamma; \emptyset
    \vdash \Nat^\Phi
    \,F\,G}\rho &= \{\eta : \lambda \ol{K}. \,\oCPOsem{\Gamma;
    \Phi \vdash
    F}\rho[\ol{\Phi := K}] 
      \Rightarrow \lambda \ol{K}.\,\oCPOsem{\Gamma; 
        \Phi \vdash G}\rho[\ol{\Phi := K}] \\ 
      &\hspace{0.3in}|~\forall \ol{K = (K^1, K^2, K^*) : \oCPORT_k}.\\
      &\hspace{0.4in}(\eta_{\overline{K^1}}, \eta_{\overline{K^2}})
      : \oCPORsem{\Gamma; \Phi \vdash F}\Eq_{\rho}[\ol{\Phi := K}]
      \rightarrow \oCPORsem{\Gamma; \Phi \vdash
        G}\Eq_{\rho}[\ol{\Phi := K}] \} \\
  \oCPOsem{\Gamma;\Phi \vdash \phi\ol{F}}\rho &=
  (\rho\phi)\,\ol{\oCPOsem{\Gamma;\Phi \vdash
    F}\rho}\\
  \oCPOsem{\Gamma;\Phi \vdash F+G}\rho &=
  \oCPOsem{\Gamma;\Phi \vdash F}\rho +
  \oCPOsem{\Gamma;\Phi \vdash G}\rho\\
  \oCPOsem{\Gamma;\Phi \vdash F \times G}\rho &=
  \oCPOsem{\Gamma;\Phi \vdash F}\rho \times
  \oCPOsem{\Gamma;\Phi \vdash G}\rho\\ 
  \oCPOsem{\Gamma;\Phi,\ol\gamma \vdash (\mu \phi.\lambda
    \ol{\alpha}. H)\ol{G}}\rho &= (\mu
    T^\oCPO_{H,\rho})\ol{\oCPOsem{\Gamma;\Phi,\ol\gamma \vdash G}\rho}\\
    \text{where } T^\oCPO_{H,\rho}\,F & = \lambda
  \ol{A}. \oCPOsem{\Gamma;\ol\gamma,\phi, \ol{\alpha} \vdash
    H}\rho[\phi :=  F][\ol{\alpha := A}]\\
  \text{and } T^\oCPO_{H,\rho}\,\eta &= \lambda
  \ol{A}. \oCPOsem{\Gamma;\ol\gamma,\phi, \ol{\alpha} \vdash
    H}\id_\rho[\phi := \eta][\ol{\alpha := \id_{A}}] \\
  \oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}\rho &=
    \{ t : (\textit{Lan}_{\ol{\oCPOsem{\Gamma; \ol\alpha \vdash
          K}\rho[\ol{\alpha := \_}]}} \oCPOsem{\Gamma; \Phi, \ol\alpha
      \vdash F}\rho[\ol{\alpha := \_}]) \ol{\oCPOsem{\Gamma; \Phi
        \vdash A}\rho}\\
    &\hspace{0.3in}|~(t,t) \in \oCPORsem{\Gamma;\Phi \vdash
      (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}\Eq_\rho\}\\
\end{align*}
\end{dfn}

If $\rho \in \oCPOenv$ and $\vdash F$ then we write $\oCPOsem{\vdash F}$
instead of $\oCPOsem{\vdash F}\rho$ since the environment is
immaterial.

For Definition~\ref{def:set-sem} to be well-defined, we have to check
that each object interpretation is in $\oCPO$ and, in particular, that
each contains sups of all $\omega$-chains. This will be proved by
induction on types, and in most cases existence of sups of
$\omega$-chains will follow from the induction hypotheses. However,
well-definedness needs to be proved directly for object
interpretations of $\Nat$-types. First, we have
\begin{lemma}\label{lem:nat-types-sets}
The collection of all natural transformations 
\[
\eta : \lambda \ol K. \setsem{\Gamma;\Phi \vdash F}\rho[\ol{\Phi := K}]
\Rightarrow \lambda \ol K. \setsem{\Gamma;\Phi \vdash G}\rho[\ol{\Phi :=
  K}]
\]
defines a set.
\end{lemma}
\begin{proof}
We first note that $\lambda \ol K. \setsem{\Gamma;\Phi \vdash
  F}\rho[\ol{\Phi := K}]$ and $\lambda \ol K. \setsem{\Gamma;\Phi
  \vdash G}\rho[\ol{\Phi := K}]$ are both in $[\ol{[\oCPO^k ,
      \oCPO]_{\omega}}, \oCPO]_{\omega}$. By
Proposition~\ref{prop:nat-interps-sets}, $[\ol{[\oCPO^k ,
      \oCPO]_{\omega}}, \oCPO]_{\omega}$ is locally
$\omega$-presentable. It is therefore locally small, so there are
only $\set$-many morphisms (i.e., natural transformations) between any
two functors in $[\ol{[\oCPO^k , \oCPO]_{\omega}},
  \oCPO]_{\omega}$. In particular, there are only $\set$-many
natural transformations from $\lambda \ol K. \setsem{\Gamma;\Phi
  \vdash F}\rho[\ol{\Phi := K}]$ to $\lambda \ol
K. \setsem{\Gamma;\Phi \vdash G}\rho[\ol{\Phi := K}]$.
\end{proof}

%Now, if $\C$ is any category, then given functors $F,G : \C \to \oCPO$
%and natural transformations $\eta, \eta' : F \to G$, we define $\eta
%\leq \eta'$ iff $\eta_c \leq \eta'_c$ for all $c \in \C$, i.e., iff
%$\eta_c\,x \leq \eta'_c\,x$ in $Gc$ for all $c \in \C$ and $x \in Fc$.
%If $(\eta_i)_{i < \omega}$ is a chain in $\{\eta : F \to G\}$, then
%the family of morphisms $(\bigvee_{i < \omega} \eta_i)_c = \lambda
%x. \bigvee_{i < \omega} ((\eta_i)_c\,x) : Fc \to Gc$ defines a natural
%transformation $\bigvee_{i < \omega} \eta_i : F \to G$, and this
%natural transformation is clearly the supremum of $(\eta_i)_{i <
%  \omega}$ in $\{\eta : F \to G\}$. We therefore have that $\{\eta : F
%\to G\}$ is itself an $\oCPO$.
%Letting $F = \lambda \ol
%K. \setsem{\Gamma;\Phi \vdash F}\rho[\ol{\Phi := K}]$ and $G = \lambda
%\ol K. \setsem{\Gamma;\Phi \vdash G}\rho[\ol{\Phi := K}]$, we have
%that $\oCPOsem{\Gamma; \emptyset \vdash \Nat^\Phi F\,G}\rho$ is indeed
%an $\oCPO$.

%Now, if $\C$ is any category, then given functors $F,G : \C \to \oCPO$
%and natural transformations $\eta, \eta' : F \to G$, we define $\eta
%\leq \eta'$ iff $\eta_c \leq \eta'_c$ for all $c \in \C$, i.e., iff
%$\eta_c\,x \leq \eta'_c\,x$ in $Gc$ for all $c \in \C$ and $x \in Fc$.
%If $(\eta_i)_{i < \omega}$ is a chain in $\{\eta : F \to G\}$, then
%the family of morphisms $(\bigvee_{i < \omega} \eta_i)_c = \lambda
%x. \bigvee_{i < \omega} ((\eta_i)_c\,x) : Fc \to Gc$ defines a natural
%transformation $\bigvee_{i < \omega} \eta_i : F \to G$, and this
%natural transformation is clearly the supremum of $(\eta_i)_{i <  
%  \omega}$ in $\{\eta : F \to G\}$. We therefore have that $\{\eta : F
%\to G\}$ is itself an $\oCPO$.  To show that $\oCPOsem{\Gamma;
%  \emptyset \vdash \Nat^\Phi \,F\,G}\rho$ is an $\oCPO$, we then still
%need to prove that, for any chain of natural transformations
%$(\eta_i)_{i < \omega}$ in $\oCPOsem{\Gamma; \emptyset \vdash
%  \Nat^\Phi \,F\,G}\rho$, $\bigvee_{i < \omega} \eta_i$ is again in
%$\oCPOsem{\Gamma; \emptyset \vdash \Nat^\Phi \,F\,G}\rho$.  By
%hypothesis, each $\eta_i$ is such that, for all $\ol{K = (K^1, K^2,
%  K^*) : \oCPORT_k}$,
%\[((\eta_i)_{\overline{K^1}},
%(\eta_i)_{\overline{K^2}}) : \oCPORsem{\Gamma; \Phi \vdash
%  F}\Eq_{\rho}[\ol{\Phi := K}] \rightarrow \oCPORsem{\Gamma; \Phi
%  \vdash G}\Eq_{\rho}[\ol{\Phi := K}]\] is a morphism in
%$\oCPOR$. To see that, for all $\ol{K = (K^1, K^2, K^*) : \oCPORT_k}$,
%%\[((\bigvee_{i < \omega} \eta_i)_{\overline{K^1}}, (\bigvee_{i <
%%%  \omega} \eta_i)_{\overline{K^2}}) : \oCPORsem{\Gamma; \Phi \vdash
%%  F}\Eq_{\rho}[\ol{\Phi := K}] \rightarrow \oCPORsem{\Gamma; \Phi
%%  \vdash G}\Eq_{\rho}[\ol{\Phi := K}]\] is again a morphism in
%%$\oCPOR$, we observe that
%$((\bigvee_{i < \omega} \eta_i)_{\overline{K^1}}, (\bigvee_{i <
%  \omega} \eta_i)_{\overline{K^2}})$ is a morphism from
%$\oCPORsem{\Gamma; \Phi \vdash F}\Eq_{\rho}[\ol{\Phi := K}]$ to
%$\oCPORsem{\Gamma; \Phi \vdash G}\Eq_{\rho}[\ol{\Phi := K}]$ in
%$\oCPOR$, we simply observe that
%\[((\bigvee_{i < \omega} \eta_i)_{\overline{K^1}}, (\bigvee_{i < \omega}
%\eta_i)_{\overline{K^2}}) = (\bigvee_{i < \omega}
%(\eta_i)_{\overline{K^1}}, \bigvee_{i < \omega}
%(\eta_i)_{\overline{K^2}}) = \bigvee_{i < \omega}
%((\eta_i)_{\overline{K^1}}, (\eta_i)_{\overline{K^2}})\] so
%$((\bigvee_{i < \omega} \eta_i)_{\overline{K^1}}, (\bigvee_{i <
%  \omega} \eta_i)_{\overline{K^2}})$ is the sup of a chain of
%morphisms from $\oCPORsem{\Gamma; \Phi \vdash F}\Eq_{\rho}[\ol{\Phi :=
%    K}]$ to $\oCPORsem{\Gamma; \Phi \vdash G}\Eq_{\rho}[\ol{\Phi :=
%    K}]$ in $\oCPOR$ and thus is itself such a morphism. Taken
%together, this all shows that $\oCPOsem{\Gamma; \emptyset \vdash
%  \Nat^\Phi \,F\,G}\rho$ is indeed an $\oCPO$.

That each of the above interpretations is $\omega$-cocontinuous
follows from Corollary~12 of~\cite{jp19} if we \new{APPROPRIATELY
  RESTRICT THE SUBSCRIPTS OF $\Lan$s; we will require that $K$ is a
  polynomial functor in the $\alpha$s that does not involve any
  constant functors}. For $\Nat$-types, we note that $\oCPOsem{\Gamma;
  \emptyset \vdash \Nat^\Phi F\,G}$ is an $\omega$-cocontinuous
functor because, in accordance with
Definition~\ref{def:set-sem-funcs}, it is constant on
$\omega$-directed sets. Interpretations of $\Nat$-types ensure that
$\oCPOsem{\Gamma \vdash F \to G}$ and $\oCPOsem{\Gamma \vdash \forall
  \ol\alpha. F}$ are as expected in any parametric model.

To make sense of the next-to-last clause in
Definition~\ref{def:set-sem}, we need to know that, for each $\rho \in
\oCPOenv$, $T^\oCPO_{H,\rho}$ is an $\omega$-cocontinuous
endofunctor on $[\oCPO^k, \oCPO]_{\omega}$, and thus admits a
fixpoint.  Since $T_{H,\rho}^\oCPO$ is defined in terms of
$\oCPOsem{\Gamma;\ol\gamma,\phi, \ol{\alpha} \vdash H}$, this means
that interpretations of types must be such functors, which in turn
means that the actions of set interpretations of types on objects and
on morphisms in $\oCPOenv$ are intertwined. Fortunately, we know
from~\cite{jp19} that, for every $\Gamma; \ol\alpha \vdash F$,
$\oCPOsem{\Gamma; \Phi \vdash F}$ is actually in
$[\oCPO^k,\oCPO]_{\omega}$, where $k = |\ol\alpha|$.  Therefore, for
each $\oCPOsem{\Gamma; \ol\gamma, \phi^k, \ol{\alpha} \vdash H}$, the
corresponding operator $T^\oCPO_{H}$ can be extended to a {\em
  functor} from $\oCPOenv$ to
$[[\oCPO^k,\oCPO]_{\omega},[\oCPO^k,\oCPO]_{\omega}]_{\omega}$.
The action of $T^\oCPO_H$ on an object $\rho \in \oCPOenv$ is given by
the higher-order functor $T_{H,\rho}^\oCPO$, whose actions on objects
(functors in $[\oCPO^k, \oCPO]_{\omega}$) and on morphisms (natural
transformations between such functors) are given in
Definition~\ref{def:set-sem}. The action of $T^\oCPO_H$ on a morphism
$f : \rho \to \rho'$ is the higher-order natural transformation
$T^\oCPO_{H,f} : T^\oCPO_{H,\rho} \to T^\oCPO_{H,\rho'}$ whose action
on $F : [\oCPO^k,\oCPO]_{\omega}$ is the natural transformation
$T^\oCPO_{H,f}\, F : T^\oCPO_{H,\rho}\,F \to T^\oCPO_{H,\rho'}\,F$
whose component at $\ol A$ is $(T^\oCPO_{H,f}\, F)_{\ol A} =
\oCPOsem{\Gamma; \ol\gamma,\phi,\ol{\alpha} \vdash H}f[\phi :=
  \id_F][\ol{\alpha := \id_A}]$.

%For the last clause in Definition~\ref{def:set-sem} to be well-defined
%we need $\oCPOsem{\Gamma; \ol\alpha \vdash K}\rho[\ol{\alpha := \_}]$
%and $\oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho[\ol{\alpha :=
%    \_}]$ to be $\omega$-cocontinuous functors.
In addition, for each $\ol K$, we have that $\textit{Lan}_{\ol K}$ is
itself a (higher-order) functor. Specifically, given functors $F, F' :
\C \to \D$, a sequence of functors $\ol K = K_1, ..., K_n$ with $K_i :
\C \to \C_i$ for $i = 1,...,n$, and a natural transformation $\alpha :
F \to F'$, the functorial action $\textit{Lan}_{\ol K} \alpha :
\textit{Lan}_{\ol K} F \to \textit{Lan}_{\ol K} F'$ of
$\mathit{Lan}_{\ol K}$ on $\alpha$ is defined to be the unique natural
transformation such that $((\textit{Lan}_{\ol K} \alpha) \,\circ
\,\langle K_1,...,K_n \rangle) \circ \eta_F = \eta_{F'} \,\circ\,
\alpha$. Here, $\eta_F : F \to (\textit{Lan}_{\ol K} F) \circ \langle
K_1,...,K_n \rangle$ and $\eta_{F'} : F' \to (\textit{Lan}_{\ol K} F')
\circ \langle K_1,...,K_n \rangle$ are the natural transformations
associated with the functors $\textit{Lan}_{\ol K} F$ and
$\textit{Lan}_{\ol K} F'$ from $\Pi_{i \in \{1,...,n\}} \C_i$ to $\D$,
respectively. It is not hard to see that $\mathit{Lan}_{\ol K}$ is a
(higher-order) functor under this definition.

The next definition uses the functors $T^\oCPO_H$ and $\mathit{Lan}_K$
to define the actions of functors interpreting types on morphisms
between set environments.

\begin{dfn}\label{def:set-sem-funcs}
Let $f: \rho \to \rho'$ be a morphism between $\oCPO$ environments $\rho$
and $\rho'$ (so that $\rho|_\tvars = \rho'|_\tvars$). The action
$\oCPOsem{\Gamma;\Phi \vdash F}f$ of\, $\oCPOsem{\Gamma;\Phi \vdash F}$
on the morphism $f$ is given as follows:
\begin{itemize}
\item If \,$\Gamma;\Phi \vdash \zerot$ then $\oCPOsem{\Gamma;\Phi \vdash
  \zerot}f = \id_0$
\item If \,$\Gamma;\Phi \vdash \onet$ then $\oCPOsem{\Gamma;\Phi \vdash
  \onet}f = \id_1$
\item If \,$\Gamma; \emptyset
  \vdash \Nat^\Phi F\,G$ then
  $\oCPOsem{\Gamma; \emptyset
    \vdash \Nat^\Phi F\,G} f =
  \id_{\oCPOsem{\Gamma; \emptyset
      \vdash \Nat^\Phi F\,G}\rho}$
\item If \,$\Gamma;\Phi \vdash \phi \ol{F}$ then
 \begin{multline*}
 \oCPOsem{\Gamma;\Phi \vdash \phi \ol{F}} f : \oCPOsem{\Gamma;\Phi
  \vdash \phi \ol{F}}\rho \to \oCPOsem{\Gamma;\Phi \vdash
  \phi\ol{F}}\rho' \\
  = (\rho\phi) \ol{\oCPOsem{\Gamma;\Phi \vdash
  F}\rho} \to (\rho'\phi) \ol{\oCPOsem{\Gamma;\Phi \vdash
  F}\rho'}
 \end{multline*}
  is defined by
  \[
  \begin{split}
  \oCPOsem{\Gamma;\Phi \vdash \phi \ol{F}} f
  &= (f\phi)_{\ol{\oCPOsem{\Gamma;\Phi \vdash
      F}\rho'}}\, \circ\, (\rho\phi) {\ol{\oCPOsem{\Gamma;\Phi
      \vdash F}f}} \\
  &= (\rho'\phi) {\ol{\oCPOsem{\Gamma;\Phi \vdash
      F}f}}\, \circ\, (f \phi)_{\ol{\oCPOsem{\Gamma;\Phi \vdash
      F}\rho}}
  \end{split}
  \]
  The latter equality holds because $\rho\phi$ and
  $\rho'\phi$ are functors and $f\phi : \rho\phi \to \rho'\phi$ is a
  natural transformation, so the following naturality square commutes:
{\footnotesize\begin{equation}\label{eq:cd2}
\begin{CD}
  (\rho\phi) \ol{\oCPOsem{\Gamma;\Phi \vdash F}\rho} @> (f\phi)_{
    \ol{\oCPOsem{\Gamma;\Phi \vdash F}\rho}} >> (\rho'\phi)
  \ol{\oCPOsem{\Gamma;\Phi \vdash F}\rho} \\ @V(\rho\phi)
  \ol{\oCPOsem{\Gamma;\Phi \vdash F}f}VV @V (\rho'\phi)
  \ol{\oCPOsem{\Gamma;\Phi \vdash F}f} VV \\ (\rho\phi)
  \ol{\oCPOsem{\Gamma;\Phi \vdash F}\rho'} @>(f\phi)_{
    \ol{\oCPOsem{\Gamma;\Phi \vdash F}\rho'}}>> (\rho'\phi)
  \ol{\oCPOsem{\Gamma;\Phi \vdash F}\rho'}
\end{CD}
\end{equation}}
\item If\, $\Gamma;\Phi \vdash F + G$ then $\oCPOsem{\Gamma;\Phi
  \vdash F + G}f$ is defined by
  \begin{align*}
  \oCPOsem{\Gamma;\Phi \vdash F + G}f(\inl\,x) 
  &= \inl\,(\oCPOsem{\Gamma;\Phi \vdash
  F}f x) \\
  \oCPOsem{\Gamma;\Phi \vdash F + G}f(\inr\,y)
  &= \inr\,(\oCPOsem{\Gamma;\Phi \vdash G}f y)
  \end{align*}
\item If \,$\Gamma;\Phi\vdash F \times G$ then
  $\oCPOsem{\Gamma;\Phi \vdash F \times G}f = 
  \oCPOsem{\Gamma;\Phi \vdash F}f \times \oCPOsem{\Gamma;\Phi \vdash
    G}f$
\item If \,$\Gamma;\Phi,\ol\gamma \vdash (\mu \phi.\lambda
  \ol{\alpha}. H)\ol{G}$ then
  \[\begin{array}{lll}
  \oCPOsem{\Gamma;\Phi,\ol\gamma \vdash (\mu  \phi.\lambda
    \ol{\alpha}. H)\ol{G}} f &: &\oCPOsem{\Gamma;\Phi,\ol\gamma 
    \vdash (\mu \phi.\lambda \ol{\alpha}. H)\ol{G}} \rho \to
  \oCPOsem{\Gamma;\Phi,\ol\gamma \vdash (\mu
    \phi.\lambda\ol{\alpha}. H)\ol{G}} \rho'\\
  &= &(\mu
  T^\oCPO_{H,\rho})\ol{\oCPOsem{\Gamma;\Phi,\ol\gamma \vdash G}\rho} \to (\mu
  T^\oCPO_{H,\rho'})\ol{\oCPOsem{\Gamma;\Phi,\ol\gamma \vdash G}\rho'}
  \end{array}\]
  is
  defined by
  \[\begin{array}{ll}
  & (\mu T^\oCPO_{H,f})_{\ol{\oCPOsem{\Gamma;\Phi,\ol\gamma \vdash
      G}\rho'}} \circ (\mu T^\oCPO_{H,\rho})\ol{\oCPOsem{\Gamma;\Phi,\ol\gamma
      \vdash G}f}\\[2ex] = & (\mu
  T^\oCPO_{H,\rho'})\ol{\oCPOsem{\Gamma;\Phi,\ol\gamma 
      \vdash G}f} \circ (\mu T^\oCPO_{H,f})_{\ol{\oCPOsem{\Gamma;\Phi,\ol\gamma
      \vdash G}\rho}}\end{array}\]  The latter equality holds because $\mu
  T^\oCPO_{H,\rho}$ and $\mu T^\oCPO_{H,\rho'}$ are functors and $\mu
  T_{H,f}^\oCPO : \mu T_{H,\rho}^\oCPO \to \mu T_{H,\rho'}^\oCPO$ is a
  natural transformation, so the following naturality square commutes:
{\footnotesize\begin{equation}\label{eq:cd3}
\begin{CD}
 (\mu T^\oCPO_{H,\rho}) \ol{\oCPOsem{\Gamma;\Phi,\ol\gamma \vdash G}\rho} @> (\mu
  T^\oCPO_{H,f})_{\ol{\oCPOsem{\Gamma;\Phi,\ol\gamma \vdash G}\rho}} >> (\mu
  T^\oCPO_{H,\rho'}) \ol{\oCPOsem{\Gamma;\Phi,\ol\gamma \vdash G}\rho} \\ 
 @V(\mu T^\oCPO_{H,\rho}) \ol{\oCPOsem{\Gamma;\Phi,\ol\gamma \vdash G}f}VV @V  (\mu
 T^\oCPO_{H,\rho'}) \ol{\oCPOsem{\Gamma;\Phi,\ol\gamma \vdash G}f} VV \\ 
(\mu T^\oCPO_{H,\rho}) \ol{\oCPOsem{\Gamma;\Phi,\ol\gamma \vdash G}\rho'} @>(\mu
 T^\oCPO_{H,f})_{\ol{\oCPOsem{\Gamma;\Phi,\ol\gamma \vdash G}\rho'}}>> (\mu
 T^\oCPO_{H,\rho'}) \ol{\oCPOsem{\Gamma;\Phi,\ol\gamma \vdash G}\rho'}
\end{CD}
\end{equation}}
\item If\, $\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}$ then
  \[\oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}f
: \oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}}
    F)\ol{A}}\rho \to \oCPOsem{\Gamma;\Phi \vdash
    (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}\rho'\] is defined by
\[\begin{array}{ll}
 & \big(\textit{Lan}_{\ol{\oCPOsem{\Gamma; \ol\alpha \vdash K}\rho[\ol{\alpha := \_}]}}\,
      \oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}f[\ol{\alpha := \id_{\_}}]\big)
    \ol{\oCPOsem{\Gamma; \Phi \vdash A}\rho'} \\
 &  \circ\;
  \big(\textit{Lan}_{\ol{\oCPOsem{\Gamma; \ol\alpha \vdash K}\rho[\ol{\alpha := \_}]}}\,
      \oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho[\ol{\alpha := \_}]\big)
    \ol{\oCPOsem{\Gamma; \Phi \vdash A}f} \\
= & \big(\textit{Lan}_{\ol{\oCPOsem{\Gamma; \ol\alpha \vdash K}\rho[\ol{\alpha := \_}]}}\,
      \oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := \_}]\big)
    \ol{\oCPOsem{\Gamma; \Phi \vdash A}f} \\
 &  \circ\;
  \big(\textit{Lan}_{\ol{\oCPOsem{\Gamma; \ol\alpha \vdash K}\rho[\ol{\alpha := \_}]}}\,
      \oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}f[\ol{\alpha := \id_{\_}}]\big)
    \ol{\oCPOsem{\Gamma; \Phi \vdash A}\rho}
\end{array}\]
where the above equality holds by naturality of
$\textit{Lan}_{\ol{\oCPOsem{\Gamma; \ol\alpha \vdash
        K}\rho[\ol{\alpha := \_}]}}\,\oCPOsem{\Gamma; \Phi, \ol\alpha
    \vdash F}f[\ol{\alpha := \id_{\_}}]$.
%(and functoriality of
%  $\textit{Lan}_{\ol{\oCPOsem{\Gamma; \ol\alpha \vdash
%        K}\rho[\ol{\alpha := \_}]}}$,
%  $\textit{Lan}_{\ol{\oCPOsem{\Gamma; \ol\alpha \vdash
%        K}\rho'[\ol{\alpha := \_}]}}$, and $\ol{\oCPOsem{\Gamma; \Phi
%      \vdash A}}$).
\end{itemize}
\end{dfn}

We need to check that the functorial action on $\Lan$ types is
well-defined, i.e., that the extra condition in the interpretation of
$\Lan$ types is preserved by the functorial action, i.e., if $t :
\oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}
\rho$, then $\oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}}
  F)\ol{A}}f t : \oCPOsem{\Gamma;\Phi \vdash
  (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} \rho'$.  By definition, if $t
: \oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}
\rho$, then $(t, t) \in \oCPORsem{\Gamma;\Phi \vdash
  (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} \Eq_{\rho}$, i.e., there
exist $\ol{Z : \oCPO_0}$, $t_1 : \oCPOsem{\Gamma; \Phi, \ol\alpha
  \vdash F}\rho[\ol{\alpha := Z}]$, $t_2 : \oCPOsem{\Gamma; \Phi,
  \ol\alpha \vdash F}\rho[\ol{\alpha := Z}]$, and $\ol{g :
  \oCPORsem{\Gamma; \ol{\alpha} \vdash K}\Eq_{\rho}[\ol{\alpha :=
      \Eq_Z}] \to \oCPORsem{\Gamma; \Phi \vdash A}\Eq_{\rho}}$ such
that $\iota_{\ol{Z}, \ol{\pi_1 g}}t_1 = t$, $\kappa_{\ol{Z}, \ol{\pi_2
    g}}t_2 = t$, and $(t_1,t_2) : \oCPORsem{\Gamma; \Phi, \ol\alpha
  \vdash F}\Eq_{\rho}[\ol{\alpha := \Eq_Z}]$.  To prove that
$\oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}f t
: \oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}
\rho'$, let $\ol{Z' = Z}$, $t'_i = \oCPOsem{\Gamma; \Phi, \ol\alpha
  \vdash F} f [\ol{\alpha := \id_{Z}}] t_i$ for $i = 1, 2$, and
$\ol{g' = \oCPORsem{\Gamma; \Phi \vdash A}\Eq_f \circ g}$.  We have
to show that $\iota'_{\ol{Z'}, \ol{\pi_1 g'}}t'_1 =
\oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}f
t$, $\kappa'_{\ol{Z'}, \ol{\pi_2 g'}}t'_2 = \oCPOsem{\Gamma;\Phi
  \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}f t$, and $(t_1',t_2')
: \oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}\Eq_{\rho'}[\ol{\alpha :=
    \Eq_{Z'}}]$.  That $(t_1',t_2') : \oCPORsem{\Gamma; \Phi,
  \ol\alpha \vdash F}\Eq_{\rho'}[\ol{\alpha := \Eq_{Z'}}]$ follows
from the fact that $(t_1',t_2') = \oCPORsem{\Gamma; \Phi, \ol\alpha
  \vdash F} \Eq_f [\ol{\alpha := \id_{\Eq_{Z}}}] (t_1, t_2)$ and
$(t_1,t_2) : \oCPORsem{\Gamma; \Phi, \ol\alpha \vdash
  F}\Eq_{\rho}[\ol{\alpha := \Eq_Z}]$.  That $\iota'_{\ol{Z'},
  \ol{\pi_1 g'}}t'_1 = \oCPOsem{\Gamma;\Phi \vdash
  (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}f t$ is because
\[
\begin{array}{rl}
\iota'_{\ol{Z'}, \ol{\pi_1 g'}}t'_1
&= \iota'_{\ol{Z'}, \ol{\pi_1 g'}} (\oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F} f [\ol{\alpha := \id_{Z}}] t_1) \\
&= \oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}f (\iota_{\ol{Z}, \ol{\pi_1 g}} t_1) \\
&= \oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}f t
\end{array}
\]
where the second equality is justified by the commutativity of the diagram
\begin{equation}\label{cd:lan-comm}
\begin{tikzcd}[row sep = huge]
\oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho[\ol{\alpha := Z}]
  \ar[r, "{\iota_{\ol{Z}, \ol{\pi_1 g}}}"]
  \ar[d, "{\oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F} f [\ol{\alpha := \id_Z}]}" description]
&\colim{\ol{S}, \ol{h : \oCPOsem{\Gamma; \ol{\alpha} \vdash K}\rho[\ol{\alpha := S}] \to \oCPOsem{\Gamma; \Phi \vdash A}\rho}}
{\oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho[\ol{\alpha := S}]}
  \ar[d, "{(\Lan_{\ol{\oCPOsem{\Gamma; \ol{\alpha} \vdash K}\rho[\ol{\alpha := \_}]}} \oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}f[\ol{\alpha := \id_{\_}}]) \ol{\oCPOsem{\Gamma; \Phi \vdash A}\rho}}" description] \\
\oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := Z}]
  \ar[r, "{\iota''_{\ol{Z}, \ol{\pi_1 g}}}"]
  \ar[d, equal]
& \colim{\ol{S}, \ol{h : \oCPOsem{\Gamma; \ol{\alpha} \vdash K}\rho'[\ol{\alpha := S}] \to \oCPOsem{\Gamma; \Phi \vdash A}\rho}}
{\oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := S}]}
  \ar[d, "{(\Lan_{\ol{\oCPOsem{\Gamma; \ol{\alpha} \vdash K}\rho[\ol{\alpha := \_}]}} \oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := \_}]) \ol{\oCPOsem{\Gamma; \Phi \vdash A}f}}" description] \\
\oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := Z}]
  \ar[r, shift right = 1, "{\iota'_{\ol{Z'}, \ol{\pi_1 (\oCPORsem{\Gamma; \Phi \vdash A}\Eq_f \circ g)}}}"']
& \colim{\ol{S}, \ol{h : \oCPOsem{\Gamma; \ol{\alpha} \vdash K}\rho'[\ol{\alpha := S}] \to \oCPOsem{\Gamma; \Phi \vdash A}\rho'}}
{\oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := S}]}
\end{tikzcd}
\end{equation}
%\[
%\begin{tikzcd}
%\colim{\ol{S}, \ol{h : \oCPORsem{\Gamma; \ol{\alpha} \vdash K}\rho[\ol{\alpha := S}] \to \oCPORsem{\Gamma; \Phi \vdash A}\rho}}
%{\oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho[\ol{\alpha := S}]}
%  \ar[r, bend left = 10, "{(\Lan_{\ol{\oCPORsem{\Gamma; \ol{\alpha} \vdash K}\rho[\ol{\alpha := \_}]}} \oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}f[\ol{\alpha := \id_{\_}}]) \ol{\oCPORsem{\Gamma; \Phi \vdash A}\rho}}"]
%& \colim{\ol{S}, \ol{h : \oCPORsem{\Gamma; \ol{\alpha} \vdash K}\rho'[\ol{\alpha := S}] \to \oCPORsem{\Gamma; \Phi \vdash A}\rho'}}
%{\oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := S}]} \\
%\oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho[\ol{\alpha := Z}]
%  \ar[u, "{\iota_{\ol{Z}, \ol{\pi_1 g}}}"]
%  \ar[r, "{\oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F} f [\ol{\alpha := \id_Z}]}"]
%& \oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := Z}]
%  \ar[u, "{\iota''_{\ol{Z}, \ol{\pi_1 g}}}"]
%\end{tikzcd}
%\]
%and
%\[
%\begin{tikzcd}
%\colim{\ol{S}, \ol{h : \oCPORsem{\Gamma; \ol{\alpha} \vdash K}\rho[\ol{\alpha := S}] \to \oCPORsem{\Gamma; \Phi \vdash A}\rho}}
%{\oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := S}]}
%  \ar[r, bend left = 10, "{(\Lan_{\ol{\oCPORsem{\Gamma; \ol{\alpha} \vdash K}\rho[\ol{\alpha := \_}]}} \oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := \_}]) \ol{\oCPORsem{\Gamma; \Phi \vdash A}f}}"]
%& \colim{\ol{S}, \ol{h : \oCPORsem{\Gamma; \ol{\alpha} \vdash K}\rho'[\ol{\alpha := S}] \to \oCPORsem{\Gamma; \Phi \vdash A}\rho'}}
%{\oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := S}]} \\
%\oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := Z}]
%  \ar[u, "{\iota''_{\ol{Z}, \ol{\pi_1 g}}}"]
%  \ar[r, equal]
%& \oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho'[\ol{\alpha := Z}]
%  \ar[u, "{\iota'_{\ol{Z'}, \ol{\pi_1 (\oCPORsem{\Gamma; \Phi \vdash A}f \circ g)}}}"]
%\end{tikzcd}
%\]
Analogously, we show that $\kappa_{Z,\pi_2 g'}t'_2 = \oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}f t$.

Definitions~\ref{def:set-sem} and~\ref{def:set-sem-funcs} respect
weakening, i.e., ensure that a type and its weakenings have the same
set interpretations.

\subsection{Relational Interpretations of Types}\label{sec:rel-interp}

\begin{dfn}\label{def:rel-transf}
A {\em $k$-ary $\oCPO$ relation transformer} $F$ is a triple $(F^1,
F^2,F^*)$, where $F^1,F^2 : [\oCPO^k,\oCPO]_{\omega}$ and $F^* :
[\oCPOR^k, \oCPOR]_{\omega}$ are such that if
$R_1:\oCPOR(A_1,B_1),...,R_k:\oCPOR(A_k,B_k)$ then $F^* \ol{R} :
\oCPOR(F^1 \ol{A}, F^2 \ol{B})$, and if $(\alpha_1, \beta_1) \in
\HomoCPOR(R_1,S_1),..., (\alpha_k, \beta_k) \in \HomoCPOR(R_k,S_k)$
then $F^* \ol{(\alpha, \beta)} = (F^1 \ol{\alpha}, F^2 \ol{\beta})$.
We define $F\ol{R}$ to be $F^*\overline{R}$ and
$F\overline{(\alpha,\beta)}$ to be $F^*\overline{(\alpha,\beta)}$.
\end{dfn}
The first condition of the first sentence of
Definition~\ref{def:rel-transf} entails that $F^*\ol R$ relates sups
of chains of pairwise related elements in $F^1 \ol A$ and $F^2 \ol
B$. The last condition of the first sentence of
Definition~\ref{def:rel-transf} expands to: if $\ol{(a,b) \in R}$
implies $\ol{(\alpha\,a,\beta\,b) \in S}$ then $(c,d) \in F^*\ol{R}$
implies $(F^1 \ol{\alpha}\,c,F^2 \ol{\beta}\,d) \in F^*\ol{S}$. When
convenient we identify a $0$-ary $\oCPO$ relation transformer
$(A,B,R)$ with $R : \oCPOR(A,B)$. We may also write $\pi_1 F$ for
$F^1$ and $\pi_2 F$ for $F^2$. {\color{blue} Without loss of
  generality, we may assume that $\pi_1$ and $\pi_2$ are surjective on
  relations.} We extend these conventions to $\oCPO$ relation
environments, introduced in Definition~\ref{def:reln-env} below, in
the obvious way.

\begin{dfn}
The category $\oCPORT_k$ of $k$-ary $\oCPO$ relation transformers is
given by the following data:
\begin{itemize}
\item An object of $\oCPORT_k$ is a $k$-ary $\oCPO$ relation transformer.
\item A morphism $\delta : (G^1,G^2,G^*) \to (H^1,H^2,H^*)$ in
  $\oCPORT_k$ is a pair of natural transformations $(\delta^1,
  \delta^2)$, where $\delta^1 : G^1 \to H^1$ and $\delta^2 : G^2 \to
  H^2$ are such that, for all $\ol{R : \oCPOR(A, B)}$, if $(x, y) \in
  G^*\ol{R}$ then $(\delta^1_{\ol{A}}x, \delta^2_{\ol{B}}y) \in
  H^*\ol{R}$.
\item Identity morphisms and composition are inherited from the
  category of functors on $\oCPO$.
\end{itemize}
\end{dfn}

\begin{dfn}\label{def:RT-functor}
An endofunctor $H$ on $\oCPORT_k$ is a triple $H = (H^1,H^2,H^*)$, where
\begin{itemize}
\item $H^1$ and $H^2$ are functors from $[\oCPO^k,\oCPO]_{\omega}$ to $[\oCPO^k,\oCPO]_{\omega}$
\item $H^*$ is a functor from $\oCPORT_k$ to $[\oCPOR^k,\oCPOR]_{\omega}$
\item for all $\overline{R : \oCPOR(A,B)}$,
  $\pi_1((H^*(\delta^1,\delta^2))_{\overline{R}}) = (H^1
  \delta^1)_{\overline{A}}$ and
  $\pi_2((H^*(\delta^1,\delta^2))_{\overline{R}}) = (H^2
  \delta^2)_{\overline{B}}$
\item The action of $H$ on objects is given by $H\,(F^1,F^2,F^*) =
  (H^1F^1,\,H^2F^2,\,H^*(F^1,F^2,F^*))$
\item The action of $H$ on morphisms is given by
  $H\,(\delta^1,\delta^2) = (H^1\delta^1,H^2\delta^2)$ for
  $(\delta^1,\delta^2) : (F^1,F^2,F^*)\to (G^1,G^2,G^*)$
\end{itemize}
\end{dfn}
Since the results of applying an endofunctor $H$ to $k$-ary $\oCPO$
relation transformers and morphisms between them must again be $k$-ary
$\oCPO$ relation transformers and morphisms between them,
respectively, Definition~\ref{def:RT-functor} implicitly requires that
the following three conditions hold:\,{\em i}) if
$R_1:\oCPOR(A_1,B_1),...,R_k:\oCPOR(A_k,B_k)$, then $H^*(F^1,F^2,F^*)
\ol{R} : \oCPOR(H^1F^1 \ol{A}, H^2F^2 \ol{B})$; {\em ii}) if
$(\alpha_1, \beta_1) \in \HomoCPOR(R_1,S_1),..., (\alpha_k, \beta_k)
\in \HomoCPOR(R_k,S_k)$, then $H^*(F^1,F^2,F^*)\, \ol{(\alpha, \beta)}
= (H^1F^1\ol{\alpha}, H^2F^2 \ol{\beta})$; and {\em iii}) if
$(\delta^1,\delta^2) : (F^1,F^2,F^*)\to (G^1,G^2,G^*)$ and
$R_1:\oCPOR(A_1,B_1),...,R_k:\oCPOR(A_k,B_k)$, then
$((H^1\delta^1)_{\ol{A}}x, (H^2\delta^2)_{\ol{B}}y) \in
H^*(G^1,G^2,G^*)\ol{R}$ whenever $(x, y) \in
H^*(F^1,F^2,F^*)\ol{R}$. Note, however, that this last condition is
automatically satisfied because it is implied by the third bullet
point of Definition~\ref{def:RT-functor}.

\begin{dfn}\label{def:RT-nat-trans}
If $H$ and $K$ are endofunctors on $\oCPORT_k$, then a {\em natural
  transformation} $\sigma : H \to K$ is a pair $\sigma = (\sigma^1,
\sigma^2)$, where $\sigma^1 : H^1 \to K^1$ and $\sigma^2 : H^2 \to
K^2$ are natural transformations between endofunctors on
$[\oCPO^k,\oCPO]_{\omega}$ and the component of $\sigma$ at $F
%= (F^1,F^2,F^*)
\in \oCPORT_k$ is given by $\sigma_F = (\sigma^1_{F^1}, \sigma^2_{F^2})$.
\end{dfn}

Definition~\ref{def:RT-nat-trans} entails that $\sigma^i_{F^i}$ must
be natural in $F^i : [\oCPO^k,\oCPO]_{\omega}$, and, for every $F$,
$(\sigma^1_{F^1})_{\overline{A}}$ and
$(\sigma^2_{F^2})_{\overline{B}}$ must be natural in $\overline{A}$
and $\ol B$, respectively.  Moreover, since the results of applying
$\sigma$ to $k$-ary $\oCPO$ relation transformers must be morphisms of
$k$-ary relation transformers, Definition~\ref{def:RT-nat-trans}
implicitly requires that $(\sigma_F)_{\overline{R}} = (
(\sigma^1_{F^1})_{\overline{A}}, (\sigma^2_{F^2})_{\overline{B}})$ is
a morphism in $\oCPOR$ for any $k$-tuple of relations $\overline{R :
  \rel(A, B)}$, i.e., that if $(x, y) \in H^*F\overline{R}$, then
$((\sigma^1_{F^1})_{\overline{A}} x, (\sigma^2_{F^2})_{\overline{B}}
y) \in K^*F\overline{R}$.

Critically, we can compute $\omega$-directed colimits in
$\oCPORT_k$: it is not hard to see that if $\cal D$ is an
$\omega$-directed set then $\colim{d \in {\cal D}}{(F^1_d,
  F^2_d,F^*_d)} = (\colim{d \in {\cal D}}{F^1_d}, \colim{d \in {\cal
    D}}{F^2_d}, \colim{d \in {\cal D}}{F^*_d})$.  We define an
endofunctor $T = (T^1,T^2,T^*)$ on $\oCPORT_k$ to be {\em
  $\omega$-cocontinuous} if $T^1$ and $T^2$ are
$\omega$-cocontinuous endofunctors on $[\oCPO^k,\oCPO]_{\omega}$
and $T^*$ is an $\omega$-cocontinuous functor from $\oCPORT_k$ to
$[\oCPOR^k,\oCPOR]_{\omega}$, i.e., is in
$[\oCPORT_k,[\oCPOR^k,\oCPOR]_{\omega}]_{\omega}$.

Now, for any $k$, any $A : \oCPO$, and any $R : \oCPOR(A, B)$, let
$K^\oCPO_A$ be the constantly $A$-valued functor from $\oCPO^k$ to
$\oCPO$ and $K^\oCPOR_R$ be the constantly $R$-valued functor from
$\oCPOR^k$ to $\oCPOR$.  Also let $0$ denote either the initial object
of $\oCPO$ or the initial object of $\oCPOR$, as appropriate.
Observing that, for every $k$, $K^\oCPO_0$ is initial in
$[\oCPO^k,\oCPO]_{\omega}$, and $K^\oCPOR_0$ is initial in
$[\oCPOR^k,\oCPOR]_{\omega}$, we have that, for each $k$, $K_0 =
(K^\oCPO_0,K^\oCPO_0,K^\oCPOR_0)$ is initial in $\oCPORT_k$. Thus, if
$T = (T^1,T^2,T^*) : \oCPORT_k \to \oCPORT_k$ is an endofunctor on
$\oCPORT_k$ then we can define the $\oCPO$ relation transformer $\mu
T$ to be $\colim{i < \omega}{T^i K_0}$. It is not hard to see that
$\mu T$ is given explicitly as
\begin{equation}\label{eq:mu}
  \mu T = (\mu T^1,\mu T^2,
\colim{i < \omega}{(T^iK_0)^*})
\end{equation}
and that, as our notation suggests, it really is a fixpoint for $T$ if
$T$ is $\omega$-cocontinuous:
\begin{lemma}\label{lem:fp}
For any $T : [\oCPORT_k,\oCPORT_k]_{\omega}$, $\mu T \cong T(\mu T)$.
\end{lemma}
\noindent
The isomorphism is given by the morphisms $(\mathit{in}_1,
\mathit{in}_2) : T(\mu T) \to \mu T$ and $(in_1^{-1}, in_2^{-1}) : \mu
T \to T(\mu T)$ in $\oCPORT_k$. The latter is always a morphism in $\oCPORT_k$,
but the former need not be if $T$ is not $\omega$-cocontinuous.

It is worth noting that the third component in Equation~(\ref{eq:mu})
is the colimit in $[\oCPOR^k,\oCPOR]_{\omega}$ of third components
of $\oCPO$ relation transformers, rather than a fixpoint of an
endofunctor on $[\oCPO^k,\oCPO]_{\omega}$. That there is an
asymmetry between the first two components of $\mu T$ and its third
reflects the important conceptual observation that the third component
of an endofunctor on $\oCPORT_k$ need not be a functor on all of
$[\oCPOR^k,\oCPOR]_{\omega}$. In particular, although we can define
$T_{H,\rho}\, F$ for an $\oCPO$ relation transformer $F$ in
Definition~\ref{def:rel-sem} below, it is not clear how we could
define it for an arbitrary $F : [\oCPOR^k,\oCPOR]_{\omega}$.

\begin{dfn}\label{def:reln-env}
An {\em $\oCPO$ relation environment} maps each type variable in
$\tvars^k \cup \fvars^k$ to a $k$-ary $\oCPO$ relation
transformer.  A morphism $f : \rho \to \rho'$ between $\oCPO$
relation environments $\rho$ and $\rho'$ with $\rho|_\tvars =
\rho'|_\tvars$ maps each type constructor variable $\psi^k \in \tvars$
to the identity morphism on $\rho \psi^k = \rho' \psi^k$ and each
functorial variable $\phi^k \in \fvars$ to a morphism from the $k$-ary
$\oCPO$ relation transformer $\rho \phi$ to the $k$-ary
$\oCPO$ relation transformer $\rho' \phi$. Composition of
morphisms on $\oCPO$ relation environments is given
componentwise, with the identity morphism mapping each $\oCPO$
relation environment to itself. This gives a category of $\oCPO$
relation environments and morphisms between them, which we denote
$\oCPORenv$.
\end{dfn}

When convenient we identify a $0$-ary $\oCPO$ relation transformer
with the $\oCPO$ relation (transformer) that is its codomain and
consider an $\oCPO$ relation environment to map a type variable of
arity $0$ to an $\oCPO$ relation. If $\Phi =
\{\phi_1^{k_1},...,\phi_n^{k_n}\}$ and $\ol K = \{K_1,...,K_n\}$ where
$K_i : [\oCPOR^{k_i},\oCPOR]_{\omega}$ for $i = 1,...,n$, then we
write either $\rho[\ol{\Phi := K}]$ or $\rho[\ol{\phi := K}]$ for the
$\oCPO$ relation environment $\rho'$ such that $\rho' \phi_i = K_i$
for $i = 1,...,n$ and $\rho' \phi = \rho \phi$ if $\phi \not \in
\Phi$. If $\rho$ is an $\oCPO$ relation environment, we write $\pi_1
\rho$ and $\pi_2 \rho$ for the $\oCPO$ relation environments mapping
each type variable $\phi$ to the functors $(\rho\phi)^1$ and
$(\rho\phi)^2$, respectively.

We define, for each $k$, the notion of an $\omega$-cocontinuous
functor from $\oCPORenv$ to $\oCPORT_k$:
\begin{dfn}\label{def:relenv-functor}
A functor $H : [\oCPORenv, \oCPORT_k]_{\omega}$ is a triple $H =
(H^1,H^2,H^*)$, where
\begin{itemize}
\item $H^1$ and $H^2$ are objects in
  $[\oCPOenv,[\oCPO^k,\oCPO]_{\omega}]_{\omega}$
\item $H^*$ is a an object in
  $[\oCPORenv,[\oCPOR^k,\oCPOR]_{\omega}]_{\omega}$
\item for all $\overline{R : \oCPOR(A,B)}$ and morphisms $f$ in
  $\oCPORenv$, $\pi_1((H^*f)_{\overline{R}}) = (H^1 (\pi_1
  f))_{\overline{A}}$ and $\pi_2((H^*f)_{\overline{R}}) = (H^2 (\pi_2
  f))_{\overline{B}}$
\item The action of $H$ on $\rho$ in $\oCPORenv$ is given by $H \rho = (H^1
  (\pi_1 \rho),\,H^2 (\pi_2 \rho),\,H^*\rho)$
\item The action of $H$ on morphisms $f : \rho \to \rho'$ in $\oCPORenv$
  is given by $Hf = (H^1 (\pi_1 f),H^2 (\pi_2 f))$
\end{itemize}
\end{dfn}
\noindent Spelling out the last two bullet points above gives the
following analogues of the three conditions immediately following
Definition~\ref{def:RT-functor}: {\em i}) if $R_1 :
\oCPOR(A_1,B_1),...,R_k : \oCPOR(A_k,B_k)$, then $H^*\rho\, \ol{R} :
\oCPOR(H^1(\pi_1 \rho)\, \ol{A}, H^2(\pi_2 \rho)\, \ol{B})$; {\em ii})
if $(\alpha_1, \beta_1) \in \HomoCPOR(R_1,S_1),..., (\alpha_k,
\beta_k) \in \HomoCPOR(R_k,S_k)$, then $H^*\rho\, \ol{(\alpha, \beta)}
= (H^1(\pi_1 \rho)\,\ol{\alpha}, H^2(\pi_2 \rho)\, \ol{\beta})$; and
{\em iii}) if $f : \rho \to \rho'$ and
$R_1:\oCPOR(A_1,B_1),...,R_k:\oCPOR(A_k,B_k)$, then $((H^1(\pi_1
f))_{\ol{A}}\,x, (H^2(\pi_2 f))_{\ol{B}}\,y) \in H^*\rho'\,\ol{R}$
whenever $(x, y) \in H^*\rho\,\ol{R}$. As before, the last condition
is automatically satisfied because it is implied by the third bullet
point of Definition~\ref{def:relenv-functor}.

Considering $\oCPORenv$ as a product $\Pi_{\phi^k \in \tvars \cup
  \fvars} \oCPORT_k$, we extend the computation of $\omega$-directed
colimits in $\oCPORT_k$ to compute colimits in $\oCPORenv$ componentwise. We
similarly extend the notion of an $\omega$-cocontinuous endofunctor on
$\oCPORT_k$ componentwise to give a notion of $\omega$-cocontinuity for
functors from $\oCPORenv$ to $\oCPORT_k$.  Recalling from the start of this
subsection that Definition~\ref{def:rel-sem} is given mutually
inductively with Definition~\ref{def:set-sem} we can, at last, define:

\begin{dfn}\label{def:rel-sem}
The {\em relational interpretation}
$\oCPORsem{\cdot} : \F \to [\oCPORenv, \oCPOR]_{\omega}$ is defined by
\begin{align*}
  \oCPORsem{\Gamma;\Phi \vdash \zerot}\rho &= 0\\
  \oCPORsem{\Gamma;\Phi \vdash \onet}\rho &= 1\\
  \oCPORsem{\Gamma; \emptyset \vdash \Nat^\Phi \,F\,G}\rho &= \{\eta
  : \lambda \ol{K}.\,\oCPORsem{\Gamma; \Phi \vdash
    F}\rho[\ol{\Phi := K}] \Rightarrow \lambda \ol{K}. \,\oCPORsem{
    \Gamma; \Phi \vdash G}\rho[\ol{\phi := K}]\}\\
  &=
  \{(\eta_1,\eta_2) \in \oCPOsem{\Gamma; \emptyset
    \vdash \Nat^\Phi
    \,F\,G} (\pi_1 \rho) \times \oCPOsem{ 
    \Gamma;\emptyset
    \vdash \Nat^\Phi \,F\,G} (\pi_2
  \rho)~|~\\ 
  & \hspace{0.3in} \forall \ol{K = (K^1, K^2, K^*) : \oCPORT_{k}}.\\
  & \hspace{0.4in} ((\eta_1)_{\ol{K^1}},(\eta_2)_{\ol{K^2}}) \in
  (\oCPORsem{\Gamma; \Phi \vdash G}\rho[\ol{\Phi :=
      K}])^{\oCPORsem{\Gamma;\Phi\vdash F}\rho[\ol{\Phi := K}]} \}\\  
  \oCPORsem{\Gamma;\Phi \vdash \phi \ol{F}}\rho &=
  (\rho\phi)\ol{\oCPORsem{\Gamma;\Phi \vdash 
    F}\rho}\\
  \oCPORsem{\Gamma;\Phi \vdash F+G}\rho &=
  \oCPORsem{\Gamma;\Phi \vdash F}\rho +
  \oCPORsem{\Gamma;\Phi \vdash G}\rho\\
  \oCPORsem{\Gamma;\Phi \vdash F\times G}\rho &=
  \oCPORsem{\Gamma;\Phi \vdash F}\rho \times
  \oCPORsem{\Gamma;\Phi \vdash G}\rho\\  
   \oCPORsem{\Gamma;\Phi,\ol\gamma \vdash (\mu \phi.\lambda
    \ol{\alpha}. H)\ol{G}}\rho
  &= (\mu T_{H,\rho})\ol{\oCPORsem{\Gamma;\Phi,\ol\gamma \vdash
     G}\rho}\\
  \text{where }	T_{H,\rho}
    &= (T^\set_{H,\pi_1\rho}, T^\set_{H,\pi_2\rho}, T^\rel_{H,\rho}) \\
  \text{and } T^\oCPOR_{H,\rho}\,F
    &= \lambda \ol{R}. \oCPORsem{
      \Gamma;\ol\gamma,\phi,\ol{\alpha} \vdash H}\rho[\phi :=
    F][\ol{\alpha := R}]\\
  \text{and } T^\oCPOR_{H,\rho}\,\delta
    &= \lambda \ol{R}. \oCPORsem{
      \Gamma;\ol\gamma,\phi,\ol{\alpha} \vdash H}\id_\rho[\phi :=
    \delta][\ol{\alpha := \id_{\ol{R}}}] \\
  \oCPORsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}}
    F)\ol{A}}\rho &= \{ (t_1, t_2) : \oCPOsem{\Gamma;\Phi \vdash
    (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}\pi_1 \rho \,\times\,
  \oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}}
    F)\ol{A}}\pi_2 \rho\\
  &\hspace{0.2in}|~\exists\, \ol{Z : \oCPO_0}, t_1' : \oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}\pi_1\rho[\ol{\alpha := Z}],\, t_2' :
  \oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}\pi_2\rho[\ol{\alpha := Z}],\\
  & \hspace{0.2in} \ol{f :
  \oCPORsem{\Gamma; \ol{\alpha} \vdash K}\rho[\ol{\alpha := \Eq_Z}] \to
  \oCPORsem{\Gamma; \Phi \vdash A}\rho}\\
  &\hspace{0.2in}\mbox{such that } \iota_{\ol{Z},\ol{\pi_1 f}}t_1' = t_1,\,
  \kappa_{\ol{Z}, \ol{\pi_2 f}}t_2' = t_2,\\
  &  \hspace*{0.2in}\mbox{and } (t_1',t_2') :
  \oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho[\ol{\alpha := \Eq_Z}]\,\}
\end{align*}
\end{dfn}
\noindent
{\color{blue} In the final clause of Definition~\ref{def:rel-sem},
  $\iota_{Z,h}$ is the injection into
\[\colim{Z \,: \,\oCPO_0,\; h \,:\, \oCPOsem{\Gamma; \ol{\alpha} \vdash
      K}\pi_1\rho[\ol{\alpha := Z}] \to \oCPOsem{\Gamma; \Phi \vdash
      A}\pi_1\rho}{\oCPOsem{\Gamma; \ol{\alpha} \vdash
    F}\pi_1\rho[\ol{\alpha := Z}]}\]
  and 
  $\kappa_{Z,h}$ is the injection into
\[\colim{Z\, :\, \oCPO_0, \;h \,:\, \oCPOsem{\Gamma; \ol{\alpha} \vdash
      K}\pi_2\rho[\ol{\alpha := Z}] \to \oCPOsem{\Gamma; \Phi \vdash
    A}\pi_2\rho}{\oCPOsem{\Gamma; \ol{\alpha} \vdash
    F}\pi_2\rho[\ol{\alpha := Z}]}\]
We note that the pair $(\iota_{Z,h},\kappa_{Z,h})$ need not coincide
with the injection $j_{Z,\Eq_h}$ into 
\[\colim{Z\, :\, \oCPO_0, \;g \,:\, \oCPORsem{\Gamma; \ol{\alpha} \vdash
      K}\rho[\ol{\alpha := \Eq_Z}] \to \oCPORsem{\Gamma; \Phi \vdash
    A}\rho}{\oCPORsem{\Gamma; \ol{\alpha} \vdash
    F}\rho[\ol{\alpha := \Eq_Z}]}\]}



For Definition~\ref{def:rel-sem} to be well-defined, we have to check
that each relational interpretation is in $\oCPOR$ and, in particular,
that each relates sups of pairwise related $\omega$-chains. This will
be proved by induction on types, and in most cases it will follow from
the induction hypotheses. However, well-definedness needs to be proved
directly for relational interpretations of $\Nat$-types.

The proof that relational interpretations of $\Nat$-types define sets
is analogous to the proof of Lemma~\ref{lem:nat-types-sets}.

%Next, we
%observe that $\oCPORsem{\Gamma; \emptyset \vdash \Nat^\Phi F\,G} \rho$
%is in $\oCPOR$. It is indeed a relation between $\oCPO$s, and it
%relates sups of pairwise related $\omega$-chains of natural
%transformations because their sups are computed pointwise. More
%specifically, if $(t_i, t_i') \colon \oCPORsem{\Gamma; \emptyset
%  \vdash \Nat^\Phi F\,G} \rho$ for all $i < \omega$, then for every
%$\ol{K = (K^1, K^2, K^*) : \oCPORT_{k}}$ and every $i < \omega$ we
%have
%  \[\big((t_i)_{\ol{K^1}},\, (t'_i)_{\ol{K^2}}\big) \in
%  (\oCPORsem{\Gamma; \Phi \vdash G}\rho[\ol{\Phi :=
%      K}])^{\oCPORsem{\Gamma;\Phi\vdash F}\rho[\ol{\Phi := K}]}\] So
%  if $(a,b) \in \oCPORsem{\Gamma;\Phi\vdash F}\rho[\ol{\Phi := K}]$,
%  then $\big((t_i)_{\ol{K^1}}\,a,\, (t'_i)_{\ol{K^2}}\,b\big) \in
%  \oCPORsem{\Gamma;\Phi\vdash G}\rho[\ol{\Phi := K}]$ for all $i <
%  \omega$. But then since $\big((t_i)_{\ol{K^1}} a\big)_{i < \omega}$
%  is an $\omega$-chain in $\oCPOsem{\Gamma; \Phi \vdash
%    G}\rho[\ol{\Phi := K^1}]$ and $\big((t'_i)_{\ol{K^2}}\big)_{i <
%    \omega} b$ is an $\omega$-chain in $\oCPOsem{\Gamma; \Phi \vdash
%    G}\rho[\ol{\Phi := K^2}]$, not only are $\bigvee_{i < \omega}
%  ((t_i)_{\ol{K^1}}\,a)$ and $\bigvee_{i < \omega}
%  ((t'_i)_{\ol{K^2}}\,b)$ well-defined, but, since
%\[\oCPORsem{\Gamma;\Phi\vdash G}\rho[\ol{\Phi := K}] : \oCPOR(
%  \oCPOsem{\Gamma;\Phi\vdash G}\rho[\ol{\Phi := K^1}],
%  \oCPOsem{\Gamma;\Phi\vdash G}\rho[\ol{\Phi := K^2}])\]
%we have
%  \[
%  \Big(\big(\bigvee_{i < \omega} t_i\big)_{\ol{K^1}} \,a,
%  \big(\bigvee_{i < \omega} t'_i\big)_{\ol{K^2}} \,b\Big)
%  = \Big(\bigvee_{i < \omega} \big((t_i)_{\ol{K^1}}\,a\big),\,
%  \bigvee_{i < \omega} \big((t'_i)_{\ol{K^2}}\,b\big)\Big) \in
%          \oCPORsem{\Gamma;\Phi\vdash G}\rho[\ol{\Phi
%             := K}]\] as well. That is,
%\[
%  \Big(\big(\bigvee_{i < \omega} t_i\big)_{\ol{K^1}}, \big(\bigvee_{i
%    < \omega} t'_i\big)_{\ol{K^2}} \Big)
%  \in (\oCPORsem{\Gamma;
%    \Phi \vdash G}\rho[\ol{\Phi := K}])^{\oCPORsem{\Gamma;\Phi\vdash
%      F}\rho[\ol{\Phi := K}]}
%  \]
%i.e.,
%$( \bigvee_{i < \omega} t_i, \bigvee_{i < \omega} t'_i ) \in
%  \oCPORsem{\Gamma; \emptyset \vdash \Nat^\Phi F\,G} \rho$.

Moreover,
%as for $\oCPO$ interpretations,
$\omega$-cocontinuity of
each of the above interpretations follows from Corollary~12
of~\cite{jp19} if we \new{APPROPRIATELY RESTRICT THE SUBSCRIPTS of
$\Lan$s}. For $\Nat$-types, $\oCPORsem{\Gamma; \emptyset \vdash
  \Nat^\Phi F\,G}$ is an $\omega$-cocontinuous functor because it is
constant on $\omega$-directed sets.  Interpretations of $\Nat$-types
ensure that $\oCPORsem{\Gamma \vdash F \to G}$ and $\oCPORsem{\Gamma
  \vdash \forall \ol \alpha. F}$ are as expected in any parametric
model.

For the next-to-last clause in Definition~\ref{def:rel-sem} to be
well-defined we need $T_{H,\rho}$ to be an $\omega$-cocontinuous
endofunctor on $\oCPORT$ so that, by Lemma~\ref{lem:fp}, it admits a
fixpoint.  Since $T_{H,\rho}$ is defined in terms of
$\oCPORsem{\Gamma;\ol\gamma,\phi^k, \ol{\alpha} \vdash H}$, this means
that relational interpretations of types must be
$\omega$-cocontinuous functors from $\oCPORenv$ to $\oCPORT_0$,
which in turn entails that the actions of relational interpretations
of types on objects and on morphisms in $\oCPORenv$ are intertwined.
%Moreover, for the last clause in Definition~\ref{def:rel-sem} to be
%well-defined we need $\oCPORsem{\Gamma; \ol\alpha \vdash
%  K}\rho[\ol{\alpha := \_}]$ and $\oCPORsem{\Gamma; \Phi, \ol\alpha
%  \vdash F}\rho[\ol{\alpha := \_}]$ to be $\omega$-cocontinuous
%functors.
As for $\oCPO$ interpretations, we know from~\cite{jp19} that, for
every $\Gamma; \ol\alpha \vdash F$, $\oCPORsem{\Gamma; \ol\alpha
  \vdash F}$ is actually in $[\oCPOR^k,\oCPOR]_{\omega}$, where $k =
|\ol\alpha|$. We first define the actions of each of these functors
on morphisms between $\oCPO$ relation environments in
Definition~\ref{def:rel-sem-funcs}, and then argue that the functors
given by Definitions~\ref{def:rel-sem} and~\ref{def:rel-sem-funcs} are
well-defined and have the required properties. To do this, we extend
$T_H$ to a {\em functor} from $\oCPORenv$ to
$[[\oCPOR^k,\oCPOR]_{\omega},
  [\oCPOR^k,\oCPOR]_{\omega}]_{\omega}$.  Its action on an object
$\rho \in \oCPORenv$ is given by the higher-order functor $T_{H,\rho}$
whose actions on objects and morphisms are given in
Definition~\ref{def:rel-sem}. Its action on a morphism $f : \rho
\to \rho'$ is the higher-order natural transformation $T_{H,f} :
T_{H,\rho} \to T_{H,\rho'}$ whose action on any $F :
[\oCPOR^k,\oCPOR]_{\omega}$ is the higher-order natural
transformation $T_{H,f}\, F : T_{H,\rho}\, F \to T_{H,\rho'}\, F$
whose component at $\ol{R}$ is $(T_{H,f}\, F)_{\ol{R}} =
\oCPORsem{\Gamma; \ol\gamma,\phi,\ol{\alpha} \vdash H}f[\phi :=
  \id_F][\ol{\alpha := \id_R}]$. The next definition uses $T_H$ to
define the actions of functors interpreting types on morphisms between
$\oCPO$ relation environments.

If $\rho \in \oCPORenv$ and $\vdash F$, then we write
$\oCPORsem{\vdash F}$ instead of $\oCPORsem{\vdash F}\rho$. The
interpretations in Definitions~\ref{def:rel-sem} and in
Definition~\ref{def:rel-sem-funcs} below respect weakening.

\begin{dfn}\label{def:rel-sem-funcs}
Let $f: \rho \to \rho'$ for $\oCPO$ relation environments $\rho$ and
$\rho'$ (so that $\rho|_\tvars = \rho'|_\tvars$). The action
$\oCPORsem{\Gamma;\Phi \vdash F}f$ of $\oCPORsem{\Gamma;\Phi \vdash F}$
on the morphism $f$ for all types but $\Lan$ is given exactly as in
Definition~\ref{def:set-sem-funcs}, except that all interpretations
are $\oCPO$ relational interpretations and all occurrences of
$T^\oCPO_{H,f}$ are replaced by $T_{H,f}$.
In the $\Lan$ case, instead, define
\[
\oCPORsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} f
%: \oCPORsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} \rho
%\to \oCPORsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} \rho'
%\]
%as
%\[
= (
\oCPORsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} \pi_1 f,
\oCPORsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} \pi_2 f
)
\]
\end{dfn}

We need to show that the functorial action for the $\Lan$ case is
well-defined, i.e., that for every $(t_1, t_2) : \oCPORsem{\Gamma;\Phi
  \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}$ we have that
\[
(
\oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} (\pi_1 f) t_1,
\oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} (\pi_2 f) t_2
)
: \oCPORsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} \rho'
\]
From $(t_1, t_2) : \oCPORsem{\Gamma;\Phi \vdash
  (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}}$ we have, by definition, that
there exist $\ol{Z : \oCPO_0}$, $t_1' : \oCPOsem{\Gamma; \Phi,
  \ol\alpha \vdash F}(\pi_1\rho)[\ol{\alpha := Z}]$, $t_2' :
\oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}(\pi_2\rho)[\ol{\alpha :=
    Z}]$, $\ol{g : \oCPORsem{\Gamma; \ol{\alpha} \vdash
    K}\rho[\ol{\alpha := \Eq_Z}] \to \oCPORsem{\Gamma; \Phi \vdash
    A}\rho}$ such that $\iota_{\ol{Z},\ol{\pi_1 g}}t_1' = t_1$,
$\kappa_{\ol{Z}, \ol{\pi_2 g}}t_2' = t_2$, and $(t_1',t_2') :
\oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F}\rho[\ol{\alpha :=
    \Eq_Z}]$.  To show that
\[
(
\oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} (\pi_1 f) t_1,
\oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} (\pi_2 f) t_2
)
: \oCPORsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} \rho'
\]
let $\ol{S = Z}$, $s_1' = \oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F}
(\pi_1 f) [\ol{\alpha := Z}] t'_1$, $s_2' = \oCPOsem{\Gamma; \Phi,
  \ol\alpha \vdash F} (\pi_2 f) [\ol{\alpha := Z}] t'_2$, and $\ol{h =
  \oCPORsem{\Gamma; \Phi \vdash A} f \circ g}$.  The first thing we
need to show is that $(s'_1, s'_2) : \oCPORsem{\Gamma; \Phi, \ol\alpha
  \vdash F}\rho'[\ol{\alpha := \Eq_Z}]$, and that is because $(s'_1,
s'_2) = \oCPORsem{\Gamma; \Phi, \ol\alpha \vdash F} f [\ol{\alpha :=
    \Eq_Z}] (t'_1, t'_2)$.  The second thing we need to show is that
\[\iota'_{\ol{Z},\ol{\pi_1 h}} s_1' = \oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} (\pi_1 f) t_1\] and
\[\kappa'_{\ol{Z},\ol{\pi_2 h}} s_2' = \oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} (\pi_2 f) t_2\]  That is because
\[
\begin{array}{rl}
\iota'_{\ol{Z},\ol{\pi_1 h}} s_1' &=
\iota'_{\ol{Z},\ol{\oCPOsem{\Gamma; \Phi \vdash A} (\pi_1 f) \circ \pi_1
    g}} ( \oCPOsem{\Gamma; \Phi, \ol\alpha \vdash F} (\pi_1 f)
      [\ol{\alpha := \id_Z}] t'_1 ) \\
%      &= (\oCPOsem{\Gamma;\Phi \vdash
%        (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} (\pi_1 f) \circ
      %      \iota_{\ol{Z},\ol{\pi_1 g}}) t'_1
       &= \oCPOsem{\Gamma;\Phi
        \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} (\pi_1 f)
      (\iota_{\ol{Z},\ol{\pi_1 g}} t'_1) \\ &= \oCPOsem{\Gamma;\Phi
        \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} (\pi_1 f)
      t_1 \end{array}
\]
where the second equality is by the commutativity of diagram~\ref{cd:lan-comm}.
Analogously, we show that $\kappa'_{\ol{Z},\ol{\pi_2 h}} s_2' = \oCPOsem{\Gamma;\Phi \vdash (\Lan^{\ol{\alpha}}_{\ol{K}} F)\ol{A}} (\pi_2 f) t_2$.

To see that the functors given by Definitions~\ref{def:rel-sem}
and~\ref{def:rel-sem-funcs} are well-defined we must also show that, for
every $H$, $T_{H,\rho}\,F$ is an $\oCPO$ relation transformer for any
$\oCPO$ relation transformer $F$, and that $T_{H,f}\, F : T_{H,\rho}\,
F \to T_{H,\rho'}\, F$ is a morphism of $\oCPO$ relation transformers
for every $\oCPO$ relation transformer $F$ and every morphism $f :
\rho \to \rho'$ in $\oCPORenv$. This is an immediate consequence of
the following Lemma.

\begin{lemma}\label{lem:rel-transf-morph}
For every $\Gamma;\Phi \vdash F$, $\sem{\Gamma;\Phi \vdash F} =
(\oCPOsem{\Gamma;\Phi \vdash F}, \oCPOsem{\Gamma;\Phi \vdash
  F},\oCPORsem{\Gamma;\Phi \vdash F}) \in
[\oCPORenv,\oCPORT_0]_{\omega}$.
\end{lemma}
\noindent
The proof is a straightforward induction on the structure of $F$,
using an appropriate result from~\cite{jp19} to deduce
$\omega$-cocontinuity of $\sem{\Gamma;\Phi \vdash F}$ in each case,
together with Lemma~\ref{lem:fp} and Equation~\ref{eq:mu} for
$\mu$-types. \new{$\Lan$ types need restriction on their
  subscripts.}

We can also prove by simultaneous induction that our interpretations
of types interact well with demotion of functorial variables. Indeed,
we have that, if $\rho, \rho' : \oCPOenv$, \,$f : \rho \to \rho'$,
\,$\rho \phi = \rho \psi = \rho' \phi = \rho' \psi$, \, $f \phi = f
\psi = \id_{\rho \phi}$,\, $\Gamma; \Phi, \phi^k \vdash F$,\,
$\Gamma;\Phi,\ol{\alpha} \vdash G$,\, $\Gamma;\Phi,\alpha_1...\alpha_k
\vdash H$, and $\ol{\Gamma;\Phi \vdash K}$, then
\begin{gather}
\label{thm:demotion-objects}
\oCPOsem{\Gamma; \Phi, \phi \vdash F} \rho = \oCPOsem{\Gamma, \psi; \Phi
  \vdash F[\phi :== \psi] } \rho\\
\label{thm:demotion-morphisms}
\oCPOsem{\Gamma; \Phi, \phi \vdash F} f = \oCPOsem{\Gamma, \psi; \Phi
  \vdash F[\phi :== \psi]} f\\
%\end{gather}
%Moreover,
%\begin{lemma}\label{lem:demotion-objects}
%\begin{gather}
%\label{thm:demotion-objects}
%\setsem{\Gamma; \Phi, \phi \vdash F} \rho = \setsem{\Gamma, \psi; \Phi
%  \vdash F[\phi :== \psi] } \rho{\color{blue}[\psi := \rho \phi]}\\
%\label{thm:demotion-morphisms}
%\setsem{\Gamma; \Phi, \phi \vdash F} f = \setsem{\Gamma, \psi; \Phi
%  \vdash F[\phi :== \psi]} f{\color{blue}[\psi \mapsto f\phi]}\\
\label{eq:subs-var}
\oCPOsem{\Gamma;\Phi \vdash G[\ol{\alpha := K}]}\rho =
\oCPOsem{\Gamma;\Phi,\ol{\alpha} \vdash G}\rho[\ol{\alpha := 
\oCPOsem{\Gamma;\Phi \vdash K}\rho}]\\
\label{eq:subs-var-morph}
\oCPOsem{\Gamma;\Phi \vdash G[\ol{\alpha := K}]}f =
\oCPOsem{\Gamma;\Phi,\ol{\alpha} \vdash G}f[\ol{\alpha :=
\oCPOsem{\Gamma;\Phi \vdash K}f}]\\
\label{eq:subs-const}
\oCPOsem{\Gamma; \Phi \vdash F[\phi := H]}\rho
= \oCPOsem{\Gamma; \Phi, \phi \vdash F}\rho
[\phi := \lambda \ol{A}.\, \oCPOsem{\Gamma;\Phi,\overline{\alpha}\vdash
    H}\rho[\overline{\alpha := A}]] \\ 
\label{eq:subs-const-morph}
\oCPOsem{\Gamma; \Phi \vdash F[\phi := H]}f
= \oCPOsem{\Gamma; \Phi, \phi \vdash F}f
[\phi := \lambda \ol{A}.\,\oCPOsem{\Gamma;\Phi,\overline{\alpha}\vdash
    H}f[\overline{\alpha := \id_{\ol{A}}}]] 
\end{gather}
Identities analogous to (\ref{thm:demotion-objects}) through
(\ref{eq:subs-const-morph}) hold for $\oCPO$ relational
interpretations as well.
  
\section{The Identity Extension Lemma}\label{sec:iel}

The standard definition of the graph for a morphism $f : A \to B$ in
$\set$ is the relation $\graph{f} : \rel(A,B)$ defined by $(x,y) \in
\graph{f}$ iff $fx = y$. This definition naturally generalizes to
associate to each natural transformation between $k$-ary functors on
$\oCPO$ a $k$-ary $\oCPO$ relation transformer as follows.

First, let $f : A \to B$ be a morphism in $\oCPO$. Then the graph of
the underlying function $|f| : |A| \to |B|$ in $\set$ is an $\oCPO$
relation.  Indeed, if $(a_i, b_i) : \graph{|f|}$ for all $i < \omega$
is a chain, then $|f| a_i = b_i$ for all $i$, and consequently
$|f|(\bigvee_{i < \omega} a_i) = \bigvee_{i < \omega} (|f| a_i) =
\bigvee_{i < \omega} b_i$, i.e., $(\bigvee_{i < \omega} a_i,
\bigvee_{i < \omega} b_i) : \graph{|f|}$. We therefore define the {\em
  $\oCPO$ graph of $f$} in $\oCPO$ to be $\graph{f} =
\graph{|f|}$. Note in particular that if $A : \oCPO$ then
$\graph{\id_A}$ is an $\oCPO$ relation. We denote this $\oCPO$
relation, called the {\em equality relation on $A$}, by $\Eq_A$. It
coincides exactly with the equality relation on the underlying set
$|A|$ of $A$.

The notion of an $\oCPO$ graph relation naturally generalizes to
associate to each natural transformation between $k$-ary functors on
$\oCPO$ a $k$-ary $\oCPO$ relation transformer as follows. Recall
that, since $\oCPO$ is a locally $\omega$-presentable category,
Proposition 1.6.1 of~\cite{ar94} ensures that it has a (strong epi,
mono) factorization system. We then have:

\begin{dfn}\label{dfn:graph-nat-transf}
If $F, G: \oCPO^k \to \oCPO$ and $\alpha : F \to G$ is a natural
transformation, then the functor $\graph{\alpha}^*: \oCPOR^k \to
\oCPOR$ is defined as follows. Given $R_1 : \oCPOR(A_1, B_1),...,R_k :
\oCPOR(A_k,B_k)$, let $\iota_{R_i} : R_i \hookrightarrow A_i \times
B_i$, for $i = 1,...,k$, be the inclusion of $R_i$ as a
sub$\oCPO$ of $A_i \times B_i$, let $h_{\overline{A \times B}}$
be the unique morphism making the diagram
{\footnotesize\[\begin{tikzcd}[row sep = large] F\overline{A}
  &F(\overline{A \times B}) \ar[l, "{F\overline{\pi_1}}"'] \ar[r,
    "{F\overline{\pi_2}}"] \ar[d, dashed, "{h_{\overline{A \times
          B}}}"] &F\overline{B} \ar[r, "{\alpha_{\ol{B}}}"]
  &G\overline{B} \\ &F\overline{A} \times G\overline{B} \ar[ul,
    "{\pi_1}"] \ar[urr, "{\pi_2}"']
\end{tikzcd}\]}
\noindent
\!\!commute, and let $h_{\overline{R}} : F\overline{R} \to
F\overline{A} \times G\overline{B}$ be $h_{\overline{A \times B}}
\circ F\overline{\iota_R}$. Further, let $\alpha^\wedge\overline{R}$
be the
%If $f = e \circ m = e' \circ m'$ then $cod e = dom m$ is the same as
%$cod e' = dom m'$ up to isomorphism. This follows easily from the
%definition of a factorization system.
subobject through which $h_{\overline{R}}$ is factorized by the
(strong epi, mono) factorization system of $\oCPO$, as shown in the
following diagram: {\footnotesize\[\begin{tikzcd} F\overline{R}
  \ar[rr, "{h_{\overline{R}}}"] \ar[dr, twoheadrightarrow,
    "{q_{\alpha^\wedge\overline{R}}}"'] &&F\overline{A} \times
  G\overline{B} \\ &\alpha^\wedge\overline{R} \ar[ur, hookrightarrow,
    "{\iota_{\alpha^\wedge\overline{R}}}"']
\end{tikzcd}\]}

\noindent
Then $\alpha^\wedge\overline{R} : \oCPOR(F\overline{A},
G\overline{B})$ by construction, so the action of $\graph{\alpha}^*$
on objects of $\oCPOR$ can be given by $\langle \alpha \rangle^*
\overline{(A,B,R)} = (F\overline{A}, G\overline{B},
\iota_{\alpha^\wedge \overline{R}}\alpha^\wedge\overline{R})$. The
action of $\graph{\alpha}^*$ on morphisms of $\oCPOR$ is given by
$\graph{\alpha}^*\overline{(\beta, \beta')} = (F\overline\beta,
G\overline\beta')$.
\end{dfn}

The next lemma shows that the data in
Definition~\ref{dfn:graph-nat-transf} actually yield a relation
transformer $\graph{\alpha} = (F, G, \graph{\alpha}^*)$. We call this
the {\em $\oCPO$ graph relation transformer} for $\alpha$.

\begin{lemma}\label{lem:graph-reln-functors}
If $F,G : [\oCPO^k,\oCPO]_{\omega}$, and if $\alpha : F \to G$ is a natural
transformation, then $\graph{\alpha}$ is in $\oCPORT_k$.
\end{lemma}
\begin{proof}
Clearly, $\graph{\alpha}^*$ is $\omega$-cocontinuous, so
$\graph{\alpha}^* : [\oCPOR^k,\oCPOR]_{\omega}$. Now, suppose
$\overline{R : \oCPOR(A, B)}$, $\overline{S : \oCPOR(C, D)}$, and
$\overline{(\beta, \beta') : R \to S}$. We want to show that there
exists a morphism $\epsilon : \alpha^\wedge\overline{R} \to
\alpha^\wedge\overline{S}$ such that the diagram on the left below
commutes. Since $\ol{(\beta,\beta') : R \to S}$, there exist
$\overline{\gamma : R \to S}$ such that each diagram in the middle
commutes.  Moreover, since both $h_{\overline{C \times D}} \circ
F(\overline{\beta \times \beta'})$ and $(F\overline{\beta} \times
G\overline{\beta'}) \circ h_{\overline{A \times B}}$ make the diagram
on the right commute, they must be equal.
\begin{figure*}[ht]
\vspace*{-0.1in}
  \hspace*{-0.85in}
  \begin{minipage}[b]{0.25\linewidth}
 {\small    \[
    \begin{tikzcd}
        \alpha^\wedge\overline{R}
        \ar[r, hookrightarrow, "{\iota_{\alpha^\wedge\overline{R}}}"]
        \ar[d, "{\epsilon}"']
        & F\overline{A} \times G\overline{B}
        \ar[d, "{F\overline{\beta} \times G\overline{\beta'}}"] \\
        \alpha^\wedge\overline{S}
        \ar[r, hookrightarrow, "{\iota_{\alpha^\wedge\overline{S}}}"']
        & F\overline{C} \times G\overline{D}
    \end{tikzcd}
    \]}
\end{minipage}
\begin{minipage}[b]{0.25\linewidth}
{\small    \[
    \begin{tikzcd}
        R_i
        \ar[d, "{\gamma_i}"']
        \ar[r, hookrightarrow, "{\iota_{R_i}}"]
        &A_i \times B_i
        \ar[d, "{\beta_i \times \beta'_i}"] \\
        S_i
        \ar[r, hookrightarrow, "{\iota_{S_i}}"]
        &C_i \times D_i
    \end{tikzcd}
    \]}
\end{minipage}
\begin{minipage}[b]{0.25\linewidth}
{\footnotesize \[
      \begin{tikzcd}[row sep = large]
          F\overline{C}
          &F\overline{C} \times F\overline{D}
          \ar[l, "{\pi_1}"'] \ar[r, "{\pi_2}"]
          &F\overline{D}
          \ar[r, "{\alpha_{\ol{D}}}"]
          &G\overline{D}\\
          &F(\overline{A \times B})
          \ar[u, dashed, "{\exists !}"]
          \ar[ul, "{F\ol{\pi_1} \circ F(\overline{\beta \times \beta'})}"]
          \ar[urr, "{\alpha_{\ol{D}} \circ F\ol{\pi_2} \circ F(\overline{\beta \times \beta'})}"']
      \end{tikzcd}
      \]}
\end{minipage}
\end{figure*}
We therefore get that the right-hand square in the diagram on the left
below commutes, and thus that the entire diagram does as well.
Finally, by the left-lifting property of
$q_{\alpha^\wedge\overline{R}}$ with respect to
$\iota_{\alpha^\wedge\overline{S}}$ given by the (strong epi, mono)
factorization system there exists an $\epsilon$ such that the diagram
on the right below commutes.
\[
      \begin{tikzcd}
          F\overline{R}
          \ar[d, "{F\overline{\gamma}}"']
          \ar[r, hookrightarrow, "{F\overline{\iota_R}}"]
          \ar[rr, bend left, "{h_{\overline{R}}}"]
          &F(\overline{A \times B})
          \ar[d, "{F(\overline{\beta \times \beta'})}"]
          \ar[r, "{h_{\overline{A \times B}}}"]
          &F\overline{A} \times G\overline{B}
          \ar[d, "{F\overline{\beta} \times F\overline{\beta'}}"] \\
          F\overline{S}
          \ar[r, hookrightarrow, "{F\overline{\iota_S}}"']
          \ar[rr, bend right, "{h_{\overline{S}}}"']
          &F(\overline{C \times D})
          \ar[r, "{h_{\overline{C \times D}}}"']
          &F\overline{C} \times G\overline{D}
      \end{tikzcd}
\qquad
      \begin{tikzcd}
          F\overline{R}
          \ar[d, "{F\overline{\gamma}}"']
          \ar[r, twoheadrightarrow, "{q_{\alpha^\wedge\overline{R}}}"]
          &\alpha^\wedge\overline{R}
          \ar[d, dashed, "{\epsilon}"]
          \ar[r, hookrightarrow, "{\iota_{\alpha^\wedge\overline{R}}}"]
          &F\overline{A} \times G\overline{B}
          \ar[d, "{F\overline{\beta} \times G\overline{\beta'}}"] \\
          F\overline{S}
          \ar[r, twoheadrightarrow, "{q_{\alpha^\wedge\overline{S}}}"']
          &\alpha^\wedge\overline{S}
          \ar[r, hookrightarrow, "{\iota_{\alpha^\wedge\overline{S}}}"']
          &F\overline{C} \times G\overline{D}
      \end{tikzcd}
\]
\end{proof}

If $f : A \to B$ is a morphism in $\oCPO$ then the definition of the
$\oCPO$ graph relation transformer $\graph{f}$ for $f$ as a natural
transformation between $0$-ary functors $A$ and $B$ coincides with the
definition of $\graph{f}$ for $f$ as a morphism in $\oCPO$ given in
the second paragraph of this section.  As a result, $\oCPO$ graph
relation transformers are a reasonable extension of $\oCPO$ graph
relations to functors.

To prove the IEL, we will need to know that the equality $\oCPO$
relation transformer preserves equality relations in $\oCPOR$; see
Equation~\ref{eq:eq-pres-eq} below. This will follow from the next
lemma, which shows how to compute the action of an $\oCPO$ graph
relation transformer on any $\oCPO$ graph relation.

\begin{lemma}\label{lem:eq-reln-equalities}
If $\alpha : F \to G$ is a morphism in $[\oCPO^k, \oCPO]_{\omega}$
and $f_1: A_1 \to B_1, ..., f_k : A_k \to B_k$, then $\graph{\alpha}^*
\graph{\overline{f}} = \graph{G \ol{f} \circ \alpha_{\ol{A}}} =
\graph{\alpha_{\ol{B}} \circ F \ol{f}}$.
\end{lemma}
\begin{proof}
Since $h_{\overline{A \times B}}$ is the unique morphism making the
bottom triangle of the diagram on the left below commute, and since
$h_{\graph{\overline{f}}} = h_{\overline{A \times B}} \circ F
\,\ol{\iota_{\graph{f}}} = h_{\overline{A \times B}} \circ F
\overline{\graph{\id_A, f}}$, the universal property of the
product depicted in the diagram on the right gives
$h_{\graph{\overline{f}}} = \graph{\id_{F \ol{A}}, \alpha_{\ol{B}}
\circ F\ol{f}} : F \ol{A} \to F \ol{A} \times G \ol{B}$.
\begin{figure*}[ht]
  \vspace*{-0.15in}
  \begin{minipage}[b]{0.45\linewidth}
{\footnotesize
\[\begin{tikzcd}[row sep = large]
        &F\overline{A}
        \ar[d, "{F \overline{\graph{\id_A, f}}}" description]
        \ar[dl, equal]
        \ar[dr, "{F\ol{f}}"]\\
        F\overline{A}
        &F(\overline{A \times B})
        \ar[l, "{F\overline{\pi_1}}"']
        \ar[r, "{F\overline{\pi_2}}"]
        \ar[d, "{h_{\overline{A \times B}}}"]
        &F\overline{B}
        \ar[r, "{\alpha_{\ol{B}}}"]
        &G\overline{B}\\
        &F\overline{A} \times G\overline{B}
        \ar[ul, "{\pi_1}"] \ar[urr, "{\pi_2}"']
\end{tikzcd}\]}
\end{minipage}
  \begin{minipage}[b]{0.45\linewidth}
{\footnotesize
\[
      \begin{tikzcd}[row sep = large]
          F\overline{A}
          &F\overline{A} \times G\overline{B}
          \ar[l, "{\pi_1}"'] \ar[r, "{\pi_2}"]
          &G\overline{B}\\
          &F\overline{A}
          \ar[u, dashed, "{\exists !}"]
          \ar[ul, equal]
          \ar[r, "{F\ol{f}}"']
          &F{\ol{B}}
          \ar[u, "{\alpha_{\ol{B}}}"']
      \end{tikzcd}
      \]}
\end{minipage}
\end{figure*}

\vspace*{-0.1in}

\noindent
Moreover, $\graph{\id_{F \ol{A}}, \alpha_{\ol{B}} \circ F\ol{f}}$ is a
monomorphism in $\oCPO$ because $\id_{F \ol{A}}$ is, so its (strong
epi, mono) factorization gives $\iota_{\alpha^\wedge
  \graph{\overline{f}}} = \langle \id_{F \ol{A}}, \alpha_{\ol{B}}
\circ F\ol{f} \rangle$, and thus that $\alpha^\wedge
\graph{\overline{f}} = F\overline{A}$.
%If $e \circ m = e \circ m'$ then $m = m'$ is trivial from the
%definition of a factorization system.
Then $\iota_{\alpha^\wedge \graph{\overline{f}}} \alpha^\wedge
\graph{\overline{f}} = \graph{\id_{F \ol{A}}, \alpha_{\ol{B}} \circ
  F\ol{f}} (F \ol{A}) = \graph{ \alpha_{\ol{B}} \circ F\ol{f}
}^*$. Then $\graph{ \alpha }^* \graph{ \overline{f} } =
(F\overline{A}, G\overline{B}, \iota_{\alpha^\wedge
  \graph{\overline{f}}}\, \alpha^\wedge \graph{\overline{f}}) =
(F\overline{A}, G\overline{B}, \graph{ \alpha_{\ol{B}} \circ F\ol{f}
}^*) = \graph{ \alpha_{\ol{B}} \circ F\ol{f} }$, and, finally,
$\alpha_{\ol{B}} \circ F\ol{f} = G\ol{f} \circ \alpha_{\ol{A}}$ by
naturality of $\alpha$.
\end{proof}

The {\em equality $\oCPO$ relation transformer} on $F :
[\oCPO^k,\oCPO]_{\omega}$ is defined to be $\Eq_F =
\graph{\id_{F}}$. Specifically, $\Eq_F = (F, F, \Eq_F^*)$ with
$\Eq_F^* = \graph{\id_{F}}^*$, and Lemma~\ref{lem:eq-reln-equalities}
indeed ensures that
\begin{equation}\label{eq:eq-pres-eq}
\Eq^*_F \ol{\Eq_A}
= \graph{\id_F}^* \graph{\id_{\ol{A}}}
= \graph{F \id_{\ol{A}} \circ (\id_F)_{\ol{A}}}
= \graph{\id_{F\ol{A}} \circ \id_{F\ol{A}}}
= \graph{\id_{F\ol{A}}}
= \Eq_{F\ol{A}}
\end{equation}
for all $\ol{A : \oCPO}$.  Graph $\oCPO$ relation transformers in
general, and equality $\oCPO$ relation transformers in particular,
extend to $\oCPO$ relation environments in the obvious ways.  Indeed,
if $\rho, \rho' : \oCPOenv$ and $f : \rho \to \rho'$, then the {\em
  graph $\oCPO$ relation environment} $\graph{f}$ is defined pointwise
by $\graph{f} \phi = \graph{f \phi}$ for every $\phi$, which entails
that $\pi_1 \graph{f} = \rho$ and $\pi_2 \graph{f} = \rho'$. In
particular, the {\em equality $\oCPO$ relation environment} $\Eq_\rho$
is defined to be $\graph{\id_{\rho}}$, which entails that $\Eq_\rho
\phi = \Eq_{\rho \phi}$ for every $\phi$.  With these definitions in
hand, we can state and prove both an Identity Extension Lemma and a
Graph Lemma for our calculus.

\begin{thm}[IEL]\label{thm:iel}
  If $\rho : \oCPOenv$ and $\Gamma; \Phi \vdash F$ then
  $\oCPORsem{\Gamma; \Phi \vdash F} \Eq_\rho = \Eq_{\oCPOsem{\Gamma;
      \Phi \vdash F}\rho}$.
\end{thm}
\begin{proof}
By induction on the structure of $F$. Only the $\Nat$, application,
fixpoint, and $\Lan$ cases are non-routine.



The latter two use
Equation~\ref{eq:eq-pres-eq}. The fixpoint case also uses the
observation that, for every $i < \omega$, the following intermediate
results can be proved by simultaneous induction with
Theorem~\ref{thm:iel}: {\color{red} CHECK THIS!} for any $H$, $\rho$,
$A$, and any subformula $J$ of $H$, both $T^i_{H,\Eq_{\rho}} K_0\,
\ol{\Eq_A} = (\Eq_{(T^\set_{H,\rho})^i K_0})^* \ol{\Eq_A}$\; and\;
\[\begin{array}{ll}
&  \oCPORsem{\Gamma; \Phi, \phi, \ol{\alpha} \vdash J} \Eq_{\rho} [\phi
  := T^i_{H,\Eq_{\rho}} K_0] \overline{[\alpha := \Eq_A]}\\
=  &
\oCPORsem{\Gamma; \Phi, \phi,
  \ol{\alpha} \vdash J} \Eq_{\rho} [\phi := \Eq_{(T^\oCPO_{H,\rho})^i K_0}]
\overline{[\alpha := \Eq_A]}
\end{array}\]
hold. With these results in hand, the proof follows easily
{\color{red} for all but $\Lan$-types}. The entire proof is given in
detail in the accompanying anonymous supplementary material. As noted
there, if functorial variables of arity greater than $0$ were allowed
to appear in the bodies of $\mu$-types, then the IEL would fail.

{\color{red} For $\Lan$-types,....}


\end{proof}

\begin{lemma}[Graph Lemma]\label{lem:graph}
If $\rho, \rho' : \oCPOenv$, $f : \rho \to \rho'$, and $\Gamma; \Phi
\vdash F$, then $\graph{\oCPOsem{\Gamma; \Phi \vdash F} f} =
\oCPORsem{\Gamma; \Phi \vdash F}\graph{f}$.
\end{lemma}
\begin{proof}
Applying Lemma~\ref{lem:rel-transf-morph} to the morphisms $(f,
\id_{\rho'}) : \graph{f} \to \Eq_{\rho'}$ and $(\id_{\rho}, f) :
\Eq_{\rho} \to \graph{f}$ of relation environments gives that
\begin{multline*}
(\oCPOsem{\Gamma; \Phi \vdash F}f, \oCPOsem{\Gamma; \Phi \vdash F}\id_{\rho'})
  = \oCPORsem{\Gamma; \Phi \vdash F} (f, \id_{\rho'}) \\
:\oCPORsem{\Gamma; \Phi \vdash F}\graph{f} \to 
  \oCPORsem{\Gamma; \Phi \vdash F}\Eq_{\rho'}
\end{multline*}
and
\begin{multline*}
(\oCPOsem{\Gamma; \Phi \vdash F}\id_{\rho}, \oCPOsem{\Gamma; \Phi \vdash F}f)
  = \oCPORsem{\Gamma; \Phi \vdash F} (\id_{\rho}, f) \\
: \oCPORsem{\Gamma; \Phi \vdash F}\Eq_{\rho} 
  \to \oCPORsem{\Gamma; \Phi \vdash F}\graph{f}
\end{multline*}
Expanding the first equation gives that if $(x,y) \in \oCPORsem{\Gamma;
  \Phi \vdash F}\graph{f}$ then \[(\oCPOsem{\Gamma; \Phi \vdash F} f\,
x, \oCPOsem{\Gamma; \Phi \vdash F}\id_{\rho'}\, y) \in \oCPORsem{\Gamma;
  \Phi \vdash F}\Eq_{\rho'}\] So $\oCPOsem{\Gamma; \Phi \vdash
  F}\id_{\rho'}\, y = \id_{\oCPOsem{\Gamma; \Phi \vdash F}\rho'}\, y =
y$ and $\oCPORsem{\Gamma; \Phi \vdash F}\Eq_{\rho'} =
\Eq_{\oCPOsem{\Gamma; \Phi \vdash F}\rho'}$, and if $(x,y) \in
\oCPORsem{\Gamma; \Phi \vdash F}\graph{f}$ then $(\oCPOsem{\Gamma; \Phi
  \vdash F} f\, x, y) \in \Eq_{\oCPOsem{\Gamma; \Phi \vdash F}\rho'}$,
i.e., $\oCPOsem{\Gamma; \Phi \vdash F} f\, x = y$, i.e., $(x, y) \in
\graph{\oCPOsem{\Gamma; \Phi \vdash F} f}$.  So, we have that
$\oCPORsem{\Gamma; \Phi \vdash F}\graph{f} \subseteq
\graph{\oCPOsem{\Gamma; \Phi \vdash F}f}$.  Expanding the second
equation gives that if $x \in \oCPOsem{\Gamma; \Phi \vdash F}\rho$ then
$(\oCPOsem{\Gamma; \Phi \vdash F}\id_{\rho}\, x,$\\
$\oCPOsem{\Gamma; \Phi
  \vdash F} f\, x) \in \oCPORsem{\Gamma; \Phi \vdash F}\graph{f}$.  Then
$\oCPOsem{\Gamma; \Phi \vdash F}\id_{\rho}\, x = \id_{\oCPOsem{\Gamma;
    \Phi \vdash F}\rho} x = x$, so for any $x \in \oCPOsem{\Gamma; \Phi
  \vdash F}\rho$ we have that $(x, \oCPOsem{\Gamma; \Phi \vdash F}f\,
x) \in \oCPORsem{\Gamma; \Phi \vdash F}\graph{f}$.  Moreover, $x \in
\oCPOsem{\Gamma; \Phi \vdash F}\rho$ if and only if $(x,
\oCPOsem{\Gamma; \Phi \vdash F} f\, x) \in \graph{\oCPOsem{\Gamma; \Phi
    \vdash F}f}$ and, if $x \in \oCPOsem{\Gamma; \Phi \vdash F}\rho$
then $(x, \oCPOsem{\Gamma; \Phi \vdash F} f\, x) \in \oCPORsem{\Gamma;
  \Phi \vdash F} \graph{f}$, so if $(x, \oCPOsem{\Gamma; \Phi \vdash F}
f\, x) \in \graph{\oCPOsem{\Gamma; \Phi \vdash F}f}$ then $(x,
\oCPOsem{\Gamma; \Phi \vdash F} f\, x) \in \oCPORsem{\Gamma; \Phi \vdash
  F} \graph{f}$, i.e., $\graph{\oCPOsem{\Gamma; \Phi \vdash F}f}
\subseteq \oCPORsem{\Gamma; \Phi \vdash F} \graph{f}$.
\end{proof}




\vspace*{1in}

\hrule

\vspace*{0.1in}

\new{
Some questions/issues:
\begin{itemize}
\item Can we write zipBush and appendBush with $\partial$ and $\int$?
  We could already represent the uncurried type of appendBush
  (although not its curried type), but couldn't recurse over both
  input bushes because folds take natural transformations as inputs.
\item More generally, how do we compute with $\partial$ and $\int?$
  Can we use the colimit formulation of Lans (see Lemma 6.3.7
  of~\cite{rie16}) to get a handle on this?
\item What is the connection between exponentials and natural
  transformations? (Should we assume only small objects are
  exponentiable?) Do we want the former or the latter for
  computational purposes? (I suspect the latter.)

  [From nlab:
  In a functor category $D^C$ , a natural transformation $\alpha : F \to
  G$ is exponentiable if (though probably not ``only if'') it is
  cartesian and each component $\alpha_c : F c \to G c$ is
  exponentiable in $D$.  Given $H \to F$ we define $(\Pi_\alpha H) c =
  \Pi_{\alpha_c}(Hc)$; then for $u : c \to c'$ to obtain a map
  $\Pi_{\alpha_c} (Hc) \to \Pi_{\alpha_{c'}} (Hc')$ we need a map
  $\alpha^*_{c'}(\Pi_{\alpha_c}(Hc)) \to Hc'$. But since $\alpha$ is
  cartesian, $\alpha^*_{c'}(\Pi_{\alpha_c}(Hc)) \cong
  \alpha^*_{c}(\Pi_{\alpha_c}(Hc))$, so we have the counit
  $\alpha^*_{c}(\Pi_{\alpha_c}(Hc)) \to Hc$ that we can compose with
  $Hu$.]
\item After we understand what we can do with Lans and folds on GADTs
  we might want to try to extend calculus with term-level
  fixpoints. This would give a categorical analogue for GADTs
  of~\cite{pit98,pit00} for ADTs. Would it also more accurately
  reflect how GADTs are used in practice, or are functions over GADTs
  usually folds? Investigate applications in the literature and/or in
  implementations.
\item $\omega$CPO is a natural choice for modeling general
  recursion. We know $(Lan^\gamma_C \onet)D$ is $C \to D$ for any
  closed type $C$. (Also for select classes of open types?) So can
  model $\Nat \to \gamma$. But the functor $NX = \Nat \to X$ isn't
  $\omega$-cocontinuous. It also doesn't preserve
  $\omega$-presentable objects, i.e., countable $\omega$CPOs since
  $\Nat \to \Nat$ is not countable. So we cannot have a functor like
  $N$ as the subscript to $\Lan$ and expect the resulting $\Lan$ to be
  $\omega$-cocontinuous.
\item What functors can be subscripts to $\Lan$ and produce
  $\omega$-cocontinuous functors? We can use functors that preserve
  presentable objects by theorem in~\cite{jp19}, and possibly others
  as well. These include polynomial functors, ADTs and nested types
  seen as functors, certain (which?) GADTs seen as functors? How big
  can GADTs get? 
\end{itemize}
}

\bibliography{references}

\end{document}
