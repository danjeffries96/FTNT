% For double-blind review submission, w/o CCS and ACM Reference (max submission space)
\documentclass[acmsmall,review,anonymous]{acmart}
\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For double-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review,anonymous]{acmart}\settopmatter{printfolios=true}
%% For single-blind review submission, w/o CCS and ACM Reference (max submission space)
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For single-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true}
%% For final camera-ready submission, w/ required CCS and ACM Reference
%\documentclass[acmsmall]{acmart}\settopmatter{}


%% Journal information
%% Supplied to authors by publisher for camera-ready submission;
%% use defaults for review submission.
\acmJournal{PACMPL}
\acmVolume{1}
\acmNumber{POPL} % CONF = POPL or ICFP or OOPSLA
\acmArticle{1}
\acmYear{2020}
\acmMonth{1}
\acmDOI{} % \acmDOI{10.1145/nnnnnnn.nnnnnnn}
\startPage{1}

%% Copyright information
%% Supplied to authors (based on authors' rights management selection;
%% see authors.acm.org) by publisher for camera-ready submission;
%% use 'none' for review submission.
\setcopyright{none}
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
%\setcopyright{rightsretained}
%\copyrightyear{2018}           %% If different from \acmYear

%% Bibliography style
\bibliographystyle{ACM-Reference-Format}
%% Citation style
%% Note: author/year citations are required for papers published as an
%% issue of PACMPL.
\citestyle{acmauthoryear}   %% For author/year citations
%\citestyle{acmnumeric}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Note: Authors migrating a paper from PACMPL format to traditional
%% SIGPLAN proceedings format must update the '\documentclass' and
%% topmatter commands above; see 'acmart-sigplanproc-template.tex'.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\usepackage[utf8]{inputenc}
\usepackage{ccicons}

\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amscd}
%\usepackage{MnSymbol}
\usepackage{xcolor}

\usepackage{bbold}
\usepackage{url}
\usepackage{upgreek}
%\usepackage{stmaryrd}

\usepackage{lipsum}
\usepackage{tikz-cd}
\usetikzlibrary{cd}
\usetikzlibrary{calc}
\usetikzlibrary{arrows}

\usepackage{bussproofs}
\EnableBpAbbreviations

\input{macros}
\input{mytheorem}

\theoremstyle{definition}
\newtheorem{exmpl}{Example}

\renewcommand{\greyout}[1]{} %{{\color{gray} {#1}}} -- toggle to remove greyed text

\newcommand{\emptyfun}{{[]}}
\newcommand{\cal}{\mathcal}
%\newcommand{\fold}{\mathit{fold}}
\newcommand{\F}{\mathcal{F}}
\renewcommand{\G}{\mathcal{G}}
\newcommand{\N}{\mathcal{N}}
\newcommand{\E}{\mathcal{E}}
\newcommand{\B}{\mathcal{B}}
\renewcommand{\P}{\mathcal{A}}
\newcommand{\pred}{\mathsf{Fam}}
\newcommand{\env}{\mathsf{Env}}
\newcommand{\set}{\mathsf{Set}}
\renewcommand{\S}{\mathcal S}
\renewcommand{\C}{\mathcal{C}}
\newcommand{\D}{\mathcal{D}}
\newcommand{\A}{\mathcal{A}}
\renewcommand{\id}{\mathit{id}}
\newcommand{\map}{\mathsf{map}}
% Trick to have a \Lan operator overriding the previous definition of \Lan (left Kan extension)
\renewcommand{\Lan}{\TypeLan}
\DeclareMathOperator{\TypeLan}{Lan}
\DeclareMathOperator{\subst}{subst}
\DeclareMathOperator{\build}{build}
\DeclareMathOperator{\nil}{nil}
\DeclareMathOperator{\cons}{cons}
\newcommand{\pid}{\underline{\mathit{id}}}
\newcommand{\pcirc}{\,\underline{\circ}\,}
\newcommand{\pzero}{\underline{0}}
\newcommand{\pone}{\underline{1}}
\newcommand{\psum}{\,\underline{+}\,}
%\newcommand{\inl}{\mathit{inL}\,}
%\newcommand{\inr}{\mathit{inR}\,}
\newcommand{\pinl}{\underline{\mathit{inL}}\,}
\newcommand{\pinr}{\underline{\mathit{inR}}\,}
\newcommand{\ptimes}{\,\underline{\times}\,}
\newcommand{\ppi}{\underline{\pi_1}}
\newcommand{\pppi}{\underline{\pi_2}}
\newcommand{\pmu}{\underline{\mu}}

\title[Free Theorems for Nested Types]{Free Theorems for 
Nested Types} %% [Short Title] is optional;
                                        %% when present, will be used in
                                        %% header instead of Full Title.
%\titlenote{with title note}             %% \titlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'
%\subtitle{Subtitle}                     %% \subtitle is optional
%\subtitlenote{with subtitle note}       %% \subtitlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'


%% Author information
%% Contents and number of authors suppressed with 'anonymous'.
%% Each author should be introduced by \author, followed by
%% \authornote (optional), \orcid (optional), \affiliation, and
%% \email.
%% An author may have multiple affiliations and/or emails; repeat the
%% appropriate command.
%% Many elements are not rendered, but should be provided for metadata
%% extraction tools.

%% Author with single affiliation.
\author{Patricia Johann and Andrew Polonsky}
%\authornote{with author1 note}          %% \authornote is optional;
%                                        %% can be repeated if necessary
%\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
\affiliation{
%  \position{Position1}
%  \department{Department1}              %% \department is recommended
  \institution{Appalachian State University}            %% \institution is required
%  \streetaddress{Street1 Address1}
%  \city{City1}
%  \state{State1}
%  \postcode{Post-Code1}
%  \country{Country1}                    %% \country is recommended
}
\email{johannp@appstate.edu, andrew.polonsky@gmail.com}          %% \email is recommended


\begin{document}

\begin{abstract}
\end{abstract}

%\begin{CCSXML}
%<ccs2012>
%<concept>
%<concept_id>10011007.10011006.10011008</concept_id>
%<concept_desc>Software and its engineering~General programming languages</concept_desc>
%<concept_significance>500</concept_significance>
%</concept>
%<concept>
%<concept_id>10003456.10003457.10003521.10003525</concept_id>
%<concept_desc>Social and professional topics~History of programming languages</concept_desc>
%<concept_significance>300</concept_significance>
%</concept>
%</ccs2012>
%\end{CCSXML}
%
%\ccsdesc[500]{Software and its engineering~General programming languages}
%\ccsdesc[300]{Social and professional topics~History of programming languages}
%% End of generated code


%% Keywords
%% comma separated list
%\keywords{keyword1, keyword2, keyword3}  %% \keywords is optional



\maketitle

\section{Free theorem for $\subst$}

We already know, as a general fact, that
\begin{multline}
\setsem{\Gamma; \emptyset \,|\, x :
  \Nat^{\overline{\alpha}, 
    \overline{\gamma}} F\,G, \overline{y : \Nat^{\overline{\gamma}}
    \sigma\, \tau} \vdash ((\map_G^{\overline{\sigma},
    \overline{\tau}})_{\emptyset} \overline{y}) \circ
  (L_{\overline{\gamma}} z. x_{\overline{\sigma}, \overline{\gamma}}
  z) : \Nat^{\overline{\gamma}} F[\overline{\alpha := \sigma}]\,
  G[\overline{\alpha := \tau}]} \\
= \setsem{ \Gamma; \emptyset \,|\, x
  : \Nat^{\overline{\alpha}, \overline{\gamma}} F\, G, \overline{y :
    \Nat^{\overline{\gamma}} \sigma\, \tau} \vdash
  (L_{\overline{\gamma}} z. x_{\overline{\tau}, \overline{\gamma}} z)
  \circ ((\map_F^{\overline{\sigma}, \overline{\tau}})_{\emptyset}
  \overline{y}) : \Nat^{\overline{\gamma}} F[\overline{\alpha :=
      \sigma}]\, G[\overline{\alpha := \tau}]}
\end{multline}
In particular, if we instantiate $x$ with any term $\subst$ of type
$\vdash \Nat^{\alpha} (\Lan(\alpha + \onet) \times \Lan\alpha)\, \Lan\alpha$
(and thus there is a single $\alpha$ and no $\gamma$'s)
we have
\begin{multline}
\setsem{\Gamma; \emptyset \,|\, y : \Nat^{\emptyset} \sigma\, \tau
  \vdash ((\map_{\Lan\alpha}^{\sigma, \tau})_{\emptyset} y)
  \circ (L_{\emptyset} z. \subst_{\sigma} z)
  : \Nat^{\emptyset} (\Lan(\sigma + \onet) \times \Lan\sigma)\, \Lan\tau } \\
= \setsem{ \Gamma; \emptyset \,|\, y : \Nat^{\emptyset} \sigma\, \tau
  \vdash
  (L_{\emptyset} z. \subst_{\tau} z)
  \circ ((\map_{\Lan(\alpha + \onet) \times \Lan\alpha}^{\sigma, \tau})_{\emptyset} y)
  : \Nat^{\emptyset} (\Lan(\sigma + \onet) \times \Lan\sigma)\, \Lan\tau }
\end{multline}
Thus, for any set environment $\rho$ and any function
$f : \setsem{\Gamma; \emptyset \vdash \sigma}\rho \to \setsem{\Gamma; \emptyset \vdash \tau}\rho$,
we have that
\begin{multline}
\setsem{\Gamma; \emptyset \,|\, y : \Nat^{\emptyset} \sigma\, \tau
  \vdash ((\map_{\Lan\alpha}^{\sigma, \tau})_{\emptyset} y)
  \circ (L_{\emptyset} z. \subst_{\sigma} z)
  : \Nat^{\emptyset} (\Lan(\sigma + \onet) \times \Lan\sigma)\, \Lan\tau } \rho f \\
\setsem{\Gamma; \emptyset \,|\, y : \Nat^{\emptyset} \sigma\, \tau
  \vdash ((\map_{\Lan\alpha}^{\sigma, \tau})_{\emptyset} y)} \rho f
  \circ
  \setsem{\Gamma; \emptyset \,|\, y : \Nat^{\emptyset} \sigma\, \tau
  \vdash L_{\emptyset} z. \subst_{\sigma} z} \rho f \\
= \setsem{\Gamma; \emptyset \,|\, \emptyset
  \vdash \map_{\Lan\alpha}^{\overline{\sigma}, \overline{\tau}}} \rho f
  \circ \setsem{\Gamma; \emptyset \,|\, \emptyset
  \vdash L_{\emptyset} z. \subst_{\sigma} z} \rho \\
= \map_{\setsem{\emptyset; \alpha \vdash \Lan\alpha} [\alpha := \_]} f
  \circ
  (\setsem{\vdash \subst})_{\setsem{\Gamma; \emptyset \vdash \sigma} \rho}
\end{multline}
and
\begin{multline}
\setsem{ \Gamma; \emptyset \,|\, y : \Nat^{\emptyset} \sigma\, \tau
  \vdash
  (L_{\emptyset} z. \subst_{\tau} z)
  \circ
  ((\map_{\Lan(\alpha + \onet) \times \Lan\alpha}^{\sigma, \tau})_{\emptyset} y)
  : \Nat^{\emptyset} (\Lan(\sigma + \onet) \times \Lan\sigma)\, \Lan\tau
} \rho f \\
= \setsem{ \Gamma; \emptyset \,|\, y : \Nat^{\emptyset} \sigma\, \tau
  \vdash L_{\emptyset} z. \subst_{\tau} z
} \rho f
\circ
\setsem{ \Gamma; \emptyset \,|\, y : \Nat^{\emptyset} \sigma\, \tau
  \vdash (\map_{\Lan(\alpha + \onet) \times \Lan\alpha}^{\sigma, \tau})_{\emptyset} y
} \rho f \\
= \setsem{ \Gamma; \emptyset \,|\, \emptyset
  \vdash L_{\emptyset} z. \subst_{\tau} z
} \rho
\circ
\setsem{ \Gamma; \emptyset \,|\, \emptyset
  \vdash \map_{\Lan(\alpha + \onet) \times \Lan\alpha}^{\sigma, \tau}
} \rho f \\
= (\setsem{\vdash \subst})_{\setsem{\Gamma; \emptyset \vdash \tau}\rho}
\circ
\map_{\setsem{\emptyset; \alpha \vdash \Lan(\alpha + \onet) \times \Lan\alpha} [\alpha := \_]} f \\
= (\setsem{\vdash \subst})_{\setsem{\Gamma; \emptyset \vdash \tau}\rho}
\circ
(
\map_{
  \setsem{\emptyset; \alpha \vdash \Lan\alpha} [\alpha := \_]} (f + \onet)
\times
\map_{
  \setsem{\emptyset; \alpha \vdash \Lan\alpha} [\alpha := \_]} f
)
\end{multline}
So, we can conclude that
\begin{multline}
\map_{\setsem{\emptyset; \alpha \vdash \Lan\alpha} [\alpha := \_]} f
  \circ
  (\setsem{\vdash \subst})_{\setsem{\Gamma; \emptyset \vdash \sigma} \rho} \\
= (\setsem{\vdash \subst})_{\setsem{\Gamma; \emptyset \vdash \tau}\rho}
\circ
(
\map_{
  \setsem{\emptyset; \alpha \vdash \Lan\alpha} [\alpha := \_]} (f + \onet)
\times
\map_{
  \setsem{\emptyset; \alpha \vdash \Lan\alpha} [\alpha := \_]} f
)
\end{multline}
Moreover, for any $A, B: \set$,
we can choose $\sigma = v$ and $\tau = w$ to be variables such that
$\rho v = A$ and $\rho w = B$.
Then for any function $f : A \to B$ we have that
\begin{multline}
\map_{\setsem{\emptyset; \alpha \vdash \Lan\alpha} [\alpha := \_]} f
  \circ
  (\setsem{\vdash \subst})_{A} \\
= (\setsem{\vdash \subst})_{B}
\circ
(
\map_{
  \setsem{\emptyset; \alpha \vdash \Lan\alpha} [\alpha := \_]} (f + \onet)
\times
\map_{
  \setsem{\emptyset; \alpha \vdash \Lan\alpha} [\alpha := \_]} f
)
\end{multline}

\begin{rmk}
The above discussion does not depend on the definition of type $\Lan$.
Indeed the result holds for any type, and thus it is just a consequence of naturality.
\end{rmk}

\bibliography{references}

\end{document}
